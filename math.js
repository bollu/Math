!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t=t||self).math=n()}(this,(function(){"use strict";var t=function(t){return Math.sqrt(t.map((function(t){return t*t})).reduce((function(t,n){return t+n}),0))},n=function(n){var r=t(n);return 0===r?n:n.map((function(t){return t/r}))},r=function(t,n){return t.map((function(t){return t*n}))},e=function(t,n){return t.map((function(t,r){return t+n[r]}))},i=function(t,n){return t.map((function(t,r){return t-n[r]}))},o=function(t,n){return t.map((function(r,e){return t[e]*n[e]})).reduce((function(t,n){return t+n}),0)},u=function(t,n){return t.map((function(t,r){return(t+n[r])/2}))},c=function(){var t=arguments,n=arguments.length>0?arguments[0].length:0,r=Array(n).fill(0);return Array.from(arguments).forEach((function(t){return r.forEach((function(n,e){r[e]+=t[e]||0}))})),r.map((function(n){return n/t.length}))},a=function(t,n,r){var e=1-r;return t.map((function(t,i){return t*e+n[i]*r}))},s=function(t,n){return t[0]*n[1]-t[1]*n[0]},f=function(t,n){return[t[1]*n[2]-t[2]*n[1],t[0]*n[2]-t[2]*n[0],t[0]*n[1]-t[1]*n[0]]},h=function(t,n){var r=t[0]-n[0],e=t[1]-n[1];return Math.sqrt(r*r+e*e)},l=function(t,n){return Math.sqrt(t.map((function(r,e){return Math.pow(t[e]-n[e],2)})).reduce((function(t,n){return t+n}),0))},p=function(t){return t.map((function(t){return-t}))},v=function(t){return[-t[1],t[0]]},g=function(t){return[-t[1],t[0]]},m=Object.freeze({__proto__:null,magnitude:t,normalize:n,scale:r,add:e,subtract:i,dot:o,midpoint:u,average:c,lerp:a,cross2:s,cross3:f,distance2:h,distance3:function(t,n){var r=t[0]-n[0],e=t[1]-n[1],i=t[2]-n[2];return Math.sqrt(r*r+e*e+i*i)},distance:l,flip:p,rotate90:v,rotate270:g});function d(t){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function y(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],e=!0,i=!1,o=void 0;try{for(var u,c=t[Symbol.iterator]();!(e=(u=c.next()).done)&&(r.push(u.value),!n||r.length!==n);e=!0);}catch(t){i=!0,o=t}finally{try{e||null==c.return||c.return()}finally{if(i)throw o}}return r}(t,n)||M(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(t){return function(t){if(Array.isArray(t))return x(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||M(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(t,n){if(t){if("string"==typeof t)return x(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?x(t,n):void 0}}function x(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}var b=function(t,n){return n.length===t?n:Array(t).fill(0).map((function(t,r){return n[r]?n[r]:t}))},w=function(t,n){var r=t.length>n.length?t.length:n.length;return[t,n].map((function(t){return b(r,t)}))},P=function(t){var n="".concat(t).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return n?Math.max(0,(n[1]?n[1].length:0)-(n[2]?+n[2]:0)):0},A=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15;if("number"!=typeof t)return t;var r=parseFloat(t.toFixed(n));return P(r)===Math.min(n,P(t))?t:r},j=function(t){return null!=t&&"function"==typeof t[Symbol.iterator]},O=function t(){switch(arguments.length){case void 0:case 0:return Array.from(arguments);case 1:return j(arguments[0])&&"string"!=typeof arguments[0]?t.apply(void 0,_(arguments[0])):[arguments[0]];default:return Array.from(arguments).map((function(n){return j(n)?_(t(n)):n}))}},I=function t(){switch(arguments.length){case void 0:case 0:return Array.from(arguments);case 1:return j(arguments[0])&&"string"!=typeof arguments[0]?t.apply(void 0,_(arguments[0])):[arguments[0]];default:return Array.from(arguments).map((function(n){return j(n)?_(t(n)):n})).reduce((function(t,n){return t.concat(n)}),[])}},k=Object.freeze({__proto__:null,resize:b,resize_up:w,resize_down:function(t,n){var r=t.length>n.length?n.length:t.length;return[t,n].map((function(t){return b(r,t)}))},clean_number:A,semi_flatten_arrays:O,flatten_arrays:I}),S=1e-6,E=function(t,n){return t===n},q=function(t,n){return Math.abs(t-n)<S},z=function(t,n){return Array.from(Array(t.length-1)).map((function(r,e){return n(t[0],t[e+1])})).reduce((function(t,n){return t&&n}),!0)},N=function(t,n){var r=w(t,n);return r[0].map((function(t,n){return Math.abs(r[0][n]-r[1][n])<S})).reduce((function(t,n){return t&&n}),!0)},G=Object.freeze({__proto__:null,EPSILON:S,equivalent_arrays_of_numbers:function(){},equivalent_numbers:function t(){return 0!==arguments.length&&(1===arguments.length&&void 0!==arguments[0]?t.apply(void 0,_(arguments[0])):z(arguments,q))},equivalent_vectors:N,equivalent:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var e=O(n);if(e.length<1)return!1;var i=d(e[0]);if("undefined"===i)return!1;switch(i){case"number":return z(e,q);case"boolean":case"string":return z(e,E);case"object":return e[0].constructor===Array?N.apply(void 0,_(e)):(console.warn("comparing array of objects for equivalency by slow JSON.stringify with no epsilon check"),z(e,(function(t,n){return JSON.stringify(t)===JSON.stringify(n)})));default:console.warn("incapable of determining comparison method")}return!1}}),F=[1,0,0,0,1,0,0,0,1,0,0,0],L=function(t,n){return[t[0]*n[0]+t[3]*n[1]+t[6]*n[2]+t[9],t[1]*n[0]+t[4]*n[1]+t[7]*n[2]+t[10],t[2]*n[0]+t[5]*n[1]+t[8]*n[2]+t[11]]},D=function(t,n,r){return{vector:[t[0]*n[0]+t[3]*n[1]+t[6]*n[2],t[1]*n[0]+t[4]*n[1]+t[7]*n[2],t[2]*n[0]+t[5]*n[1]+t[8]*n[2]],origin:[t[0]*r[0]+t[3]*r[1]+t[6]*r[2]+t[9],t[1]*r[0]+t[4]*r[1]+t[7]*r[2]+t[10],t[2]*r[0]+t[5]*r[1]+t[8]*r[2]+t[11]]}},R=function(t,n){return[t[0]*n[0]+t[3]*n[1]+t[6]*n[2],t[1]*n[0]+t[4]*n[1]+t[7]*n[2],t[2]*n[0]+t[5]*n[1]+t[8]*n[2],t[0]*n[3]+t[3]*n[4]+t[6]*n[5],t[1]*n[3]+t[4]*n[4]+t[7]*n[5],t[2]*n[3]+t[5]*n[4]+t[8]*n[5],t[0]*n[6]+t[3]*n[7]+t[6]*n[8],t[1]*n[6]+t[4]*n[7]+t[7]*n[8],t[2]*n[6]+t[5]*n[7]+t[8]*n[8],t[0]*n[9]+t[3]*n[10]+t[6]*n[11]+t[9],t[1]*n[9]+t[4]*n[10]+t[7]*n[11]+t[10],t[2]*n[9]+t[5]*n[10]+t[8]*n[11]+t[11]]},Z=function(t){return t[0]*t[4]*t[8]-t[0]*t[7]*t[5]-t[3]*t[1]*t[8]+t[3]*t[7]*t[2]+t[6]*t[1]*t[5]-t[6]*t[4]*t[2]},T=function(t){var n=Z(t);if(!(Math.abs(n)<1e-6||isNaN(n))&&isFinite(t[9])&&isFinite(t[10])&&isFinite(t[11])){var r=[t[4]*t[8]-t[7]*t[5],-t[1]*t[8]+t[7]*t[2],t[1]*t[5]-t[4]*t[2],-t[3]*t[8]+t[6]*t[5],t[0]*t[8]-t[6]*t[2],-t[0]*t[5]+t[3]*t[2],t[3]*t[7]-t[6]*t[4],-t[0]*t[7]+t[6]*t[1],t[0]*t[4]-t[3]*t[1],-t[3]*t[7]*t[11]+t[3]*t[8]*t[10]+t[6]*t[4]*t[11]-t[6]*t[5]*t[10]-t[9]*t[4]*t[8]+t[9]*t[5]*t[7],t[0]*t[7]*t[11]-t[0]*t[8]*t[10]-t[6]*t[1]*t[11]+t[6]*t[2]*t[10]+t[9]*t[1]*t[8]-t[9]*t[2]*t[7],-t[0]*t[4]*t[11]+t[0]*t[5]*t[10]+t[3]*t[1]*t[11]-t[3]*t[2]*t[10]-t[9]*t[1]*t[5]+t[9]*t[2]*t[4]],e=1/n;return r.map((function(t){return t*e}))}},J=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return[1,0,0,0,1,0,0,0,1,t,n,r]},C=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=Math.cos(t),e=Math.sin(t);return[1,0,0,0,r,e,0,-e,r,n[0]||0,n[1]||0,n[2]||0]},X=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=Math.cos(t),e=Math.sin(t);return[r,0,-e,0,1,0,e,0,r,n[0]||0,n[1]||0,n[2]||0]},Y=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=Math.cos(t),e=Math.sin(t);return[r,e,0,-e,r,0,0,0,1,n[0]||0,n[1]||0,n[2]||0]},$=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0],i=n(r),o=Array.from(Array(3)).map((function(t,n){return e[n]||0})),u=y(i,3),c=u[0],a=u[1],s=u[2],f=Math.cos(t),h=Math.sin(t),l=Math.sqrt(i[1]*i[1]+i[2]*i[2]),p=Math.abs(l)<1e-6?0:a/l,v=Math.abs(l)<1e-6?1:s/l,g=[1,0,0,0,1,0,0,0,1,o[0],o[1],o[2]],m=[1,0,0,0,1,0,0,0,1,-o[0],-o[1],-o[2]],d=[1,0,0,0,v,p,0,-p,v,0,0,0],_=[1,0,0,0,v,-p,0,p,v,0,0,0],M=[l,0,c,0,1,0,-c,0,l,0,0,0],x=[l,0,-c,0,1,0,c,0,l,0,0,0],b=[f,h,0,-h,f,0,0,0,1,0,0,0];return R(m,R(_,R(x,R(b,R(M,R(d,g))))))},B=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return[t,0,0,0,t,0,0,0,t,t*-n[0]+n[0],t*-n[1]+n[1],t*-n[2]+n[2]]},H=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],r=Math.atan2(t[1],t[0]),e=Math.cos(r),i=Math.sin(r),o=Math.cos(-r),u=Math.sin(-r),c=e*o+i*u,a=e*-u+i*o,s=i*o+-e*u,f=i*-u+-e*o,h=n[0]+c*-n[0]+-n[1]*s,l=n[1]+a*-n[0]+-n[1]*f;return[c,a,0,s,f,0,0,0,0,h,l,0]},U=Object.freeze({__proto__:null,identity3x3:[1,0,0,0,1,0,0,0,1],identity3x4:F,multiply_matrix3_vector3:L,multiply_matrix3_line3:D,multiply_matrices3:R,determinant3:Z,invert_matrix3:T,make_matrix3_translate:J,make_matrix3_rotateX:C,make_matrix3_rotateY:X,make_matrix3_rotateZ:Y,make_matrix3_rotate:$,make_matrix3_scale:B,make_matrix3_reflectionZ:H,make_matrix3_reflection:function(t){return[]}}),V=function(t,n,r,e,i){var o=function(t,n){return t[0]*n[1]-n[0]*t[1]},u=o(n,e),c=-u,a=o([r[0]-t[0],r[1]-t[1]],e),s=o([t[0]-r[0],t[1]-r[1]],n);return!(Math.abs(u)<S)&&i(a/u,s/c)},K=function(t,n){return t>=-S&&t<=1+S&&n>=-S&&n<=1+S},Q=function(t,n,r,e){var i=[n[0]-t[0],n[1]-t[1]],o=[e[0]-r[0],e[1]-r[1]];return V(t,i,r,o,K)},W=function(t){return Math.abs(t.reduce((function(t,n){return t+n}),0))<S},tt=function(t,r){return 1-Math.abs(o(n(t),n(r)))<S},nt=function(t){return F.map((function(n,r){return Math.abs(n-t[r])<S})).reduce((function(t,n){return t&&n}),!0)},rt=function(t,n,r){var e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:S,i=[r[0]-t[0],r[1]-t[1]],o=i[0]*n[1]-i[1]*n[0];return Math.abs(o)<e},et=function(t,n){for(var r=!1,e=0,i=n.length-1;e<n.length;i=e++)n[e][1]>t[1]!=n[i][1]>t[1]&&t[0]<(n[i][0]-n[e][0])*(t[1]-n[e][1])/(n[i][1]-n[e][1])+n[e][0]&&(r=!r);return r},it=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S;return null!=n&&n.length>0&&n.map((function(n,e,i){var o=i[(e+1)%i.length],u=[o[0]-n[0],o[1]-n[1]],c=[t[0]-n[0],t[1]-n[1]];return u[0]*c[1]-u[1]*c[0]>-r})).map((function(t,n,r){return t===r[0]})).reduce((function(t,n){return t&&n}),!0)},ot=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S;return null!=n&&n.length>0&&n.map((function(n,e,i){var o=i[(e+1)%i.length],u=[o[0]-n[0],o[1]-n[1]],c=[t[0]-n[0],t[1]-n[1]];return u[0]*c[1]-u[1]*c[0]>r})).map((function(t,n,r){return t===r[0]})).reduce((function(t,n){return t&&n}),!0)},ut=function(t,n){for(var r=t.map((function(t,n,r){return[t,r[(n+1)%r.length]]})),e=n.map((function(t,n,r){return[t,r[(n+1)%r.length]]})),i=0;i<r.length;i+=1)for(var o=0;o<e.length;o+=1)if(Q(r[i][0],r[i][1],e[o][0],e[o][1]))return!0;return!!et(n[0],t)||!!et(t[0],n)},ct=function(t,n,r){for(;r<n;)r+=2*Math.PI;for(;t<n;)t+=2*Math.PI;return t<r},at=Object.freeze({__proto__:null,overlap_function:V,segment_segment_overlap:Q,degenerate:W,parallel:tt,is_identity3x4:nt,point_on_line:rt,point_on_segment:function(t,n,r){var e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:S,i=[t[0]-n[0],t[1]-n[1]],o=[t[0]-r[0],t[1]-r[1]],u=[n[0]-r[0],n[1]-r[1]],c=Math.sqrt(i[0]*i[0]+i[1]*i[1]),a=Math.sqrt(o[0]*o[0]+o[1]*o[1]),s=Math.sqrt(u[0]*u[0]+u[1]*u[1]);return Math.abs(c-a-s)<e},point_in_poly:et,point_in_convex_poly:it,point_in_convex_poly_exclusive:ot,convex_polygons_overlap:ut,convex_polygon_is_enclosed:function(t,n){if(n.map((function(n){return it(n,t)})).reduce((function(t,n){return t||n}),!1))return!1},convex_polygons_enclose:function(t,n){var r=n.map((function(n){return it(n,t)})).reduce((function(t,n){return t||n}),!1),e=t.map((function(n){return it(n,t)})).reduce((function(t,n){return t&&n}),!0);return!r&&e},is_counter_clockwise_between:ct}),st={},ft=[1,0,0,1,0,0],ht=function(t){return t[0]*t[3]-t[1]*t[2]},lt=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],r=Math.cos(t),e=Math.sin(t);return[r,e,-e,r,n[0],n[1]]},pt=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],r=Math.atan2(t[1],t[0]),e=Math.cos(r),i=Math.sin(r),o=Math.cos(-r),u=Math.sin(-r),c=e*o+i*u,a=e*-u+i*o,s=i*o+-e*u,f=i*-u+-e*o,h=n[0]+c*-n[0]+-n[1]*s,l=n[1]+a*-n[0]+-n[1]*f;return[c,a,s,f,h,l]},vt=Object.freeze({__proto__:null,identity2x2:[1,0,0,1],identity2x3:ft,multiply_matrix2_vector2:function(t,n){return[t[0]*n[0]+t[2]*n[1]+t[4],t[1]*n[0]+t[3]*n[1]+t[5]]},multiply_matrix2_line2:function(t,n,r){return{vector:[t[0]*n[0]+t[2]*n[1],t[1]*n[0]+t[3]*n[1]],origin:[t[0]*r[0]+t[2]*r[1]+t[4],t[1]*r[0]+t[3]*r[1]+t[5]]}},multiply_matrices2:function(t,n){return[t[0]*n[0]+t[2]*n[1],t[1]*n[0]+t[3]*n[1],t[0]*n[2]+t[2]*n[3],t[1]*n[2]+t[3]*n[3],t[0]*n[4]+t[2]*n[5]+t[4],t[1]*n[4]+t[3]*n[5]+t[5]]},determinant2:ht,invert_matrix2:function(t){var n=ht(t);if(!(Math.abs(n)<1e-6||isNaN(n))&&isFinite(t[4])&&isFinite(t[5]))return[t[3]/n,-t[1]/n,-t[2]/n,t[0]/n,(t[2]*t[5]-t[3]*t[4])/n,(t[1]*t[4]-t[0]*t[5])/n]},make_matrix2_translate:function(t,n){return[1,0,0,1,t,n]},make_matrix2_scale:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0];return[t,0,0,n,t*-r[0]+r[0],n*-r[1]+r[1]]},make_matrix2_rotate:lt,make_matrix2_reflection:pt}),gt=function(t,n){return{vector:t||[],origin:n||[]}},mt=function(){if(arguments[0]instanceof st.vector)return arguments[0];var t=I(arguments);return t.length>0&&"object"===d(t[0])&&null!==t[0]&&!isNaN(t[0].x)&&(t=["x","y","z"].map((function(n){return t[0][n]})).filter((function(t){return void 0!==t}))),t.filter((function(t){return"number"==typeof t}))},dt=function(){return O(arguments).map((function(t){return mt(t)}))},yt=function(){if(arguments[0]instanceof st.segment)return arguments[0];var t=O(arguments);return 4===t.length?[[t[0],t[1]],[t[2],t[3]]]:dt(t)},_t=function(){var t=O(arguments);return 0===t.length?gt([],[]):t[0]instanceof st.line||t[0]instanceof st.ray||t[0]instanceof st.segment?t[0]:t[0].constructor===Object?gt(t[0].vector||[],t[0].origin||[]):"number"==typeof t[0]?gt(mt(t)):gt.apply(void 0,_(t.map((function(t){return mt(t)}))))},Mt=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return{width:t,height:n,x:r,y:e}},xt=function(){if(arguments[0]instanceof st.rect)return arguments[0];var t=I(arguments);return t.length>0&&"object"===d(t[0])&&null!==t[0]&&!isNaN(t[0].width)?Mt.apply(void 0,_(["width","height","x","y"].map((function(n){return t[0][n]})).filter((function(t){return void 0!==t})))):Mt.apply(void 0,_(t.filter((function(t){return"number"==typeof t}))))},bt=[[0,1,3,4,9,10],[0,1,2,3,4,5,6,7,8,9,10,11],[0,1,2,void 0,3,4,5,void 0,6,7,8,void 0,9,10,11]];[11,7,3].forEach((function(t){return delete bt[2][t]}));var wt=function(t){return bt[t<8?0:t<13?1:2]},Pt=function(){var t=I(arguments),n=_(F);return wt(t.length).filter((function(n,r){return null!=t[r]})).forEach((function(r,e){n[r]=t[e]})),n},At=Object.freeze({__proto__:null,get_vector:mt,get_vector_of_vectors:dt,get_segment:yt,get_line:_t,rect_form:Mt,get_rect:xt,get_matrix_3x4:Pt,get_matrix2:function(){var t=mt(arguments);if(void 0!==t)return 6===t.length?t:t.length>6?[t[0],t[1],t[2],t[3],t[4],t[5]]:t.length<6?ft.map((function(n,r){return t[r]||n})):void 0}}),jt=function(){return!0},Ot=function(t,n){return n>=-S},It=function(t,n){return n>=-S&&n<=1+S},kt=function(t,n){return t>=-S&&n>=-S},St=function(t,n){return t>=-S&&n>=-S&&n<=1+S},Et=function(t,n){return t>=-S&&t<=1+S&&n>=-S&&n<=1+S},qt=function(t,n){return n>S},zt=function(t,n){return n>S&&n<1-S},Nt=function(t,n){return t>S&&n>S},Gt=function(t,n){return t>S&&n>S&&n<1-S},Ft=function(t,n){return t>S&&t<1-S&&n>S&&n<1-S},Lt=function(t,n,r,e,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:S,u=s(t,r);if(!(Math.abs(u)<o)){var c=-u,a=n[0],f=n[1],h=e[0],l=e[1],p=s([h-a,l-f],r),v=s([a-h,f-l],t),g=p/u,m=v/c;return i(g,m,o)?[a+t[0]*g,f+t[1]*g]:void 0}},Dt=function(t,n,r){var e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:S;return Lt(t.vector,t.origin,n.vector,n.origin,r,e)},Rt=Object.freeze({__proto__:null,comp_l_l:jt,comp_l_r:Ot,comp_l_s:It,comp_r_r:kt,comp_r_s:St,comp_s_s:Et,exclude_l_r:qt,exclude_l_s:zt,exclude_r_r:Nt,exclude_r_s:Gt,exclude_s_s:Ft,intersect_2D:Lt,intersect:Dt}),Zt=180/Math.PI,Tt=Math.PI/180,Jt=function(t,n){for(;t<0;)t+=2*Math.PI;for(;n<0;)n+=2*Math.PI;var r=n-t;return r>=0?r:2*Math.PI-(t-n)},Ct=function(t,n){var r=t[0]*n[0]+t[1]*n[1],e=t[0]*n[1]-t[1]*n[0],i=Math.atan2(e,r);return i<0&&(i+=2*Math.PI),i},Xt=function(t,r){var i=n(t),u=n(r);return o(i,u)<-1+S?[-i[1],i[0]]:n(e(i,u))},Yt=function(t,n,r,e){var i=t[0]*r[1]-r[0]*t[1];if(Math.abs(i)<S){var o=[[t[0],t[1]],u(n,e)],c=[o,o];return delete c[t[0]*r[0]+t[1]*r[1]>0?1:0],c}var a=((e[0]-n[0])*r[1]-r[0]*(e[1]-n[1]))/i,s=[n[0]+t[0]*a,n[1]+t[1]*a],f=[Xt(t,r)];return f[1]=v(f[0]),f.map((function(t){return{vector:t,origin:s}}))},$t=function(t,n,r){var e=Ct(n,r)/t;return Array.from(Array(t-1)).map((function(t,r){return n+e*r}))},Bt=function(t,n,r){var e=n[0]-t[0],i=n[1]-t[1],o=r[0]-t[0],u=r[1]-t[1],c=e*(t[0]+n[0])+i*(t[1]+n[1]),a=o*(t[0]+r[0])+u*(t[1]+r[1]),s=2*(e*(r[1]-n[1])-i*(r[0]-n[0]));if(Math.abs(s)<S){var f=Math.min(t[0],n[0],r[0]),h=Math.min(t[1],n[1],r[1]),l=.5*(Math.max(t[0],n[0],r[0])-f),p=.5*(Math.max(t[1],n[1],r[1])-h);return{origin:[f+l,h+p],radius:Math.sqrt(l*l+p*p)}}var v=[(u*c-i*a)/s,(e*a-o*c)/s],g=v[0]-t[0],m=v[1]-t[1];return{origin:v,radius:Math.sqrt(g*g+m*m)}},Ht=function(t){return.5*t.map((function(t,n,r){var e=r[(n+1)%r.length];return t[0]*e[1]-e[0]*t[1]})).reduce((function(t,n){return t+n}),0)},Ut=function(t){var n=1/(6*Ht(t));return t.map((function(t,n,r){var e=r[(n+1)%r.length],i=t[0]*e[1]-e[0]*t[1];return[(t[0]+e[0])*i,(t[1]+e[1])*i]})).reduce((function(t,n){return[t[0]+n[0],t[1]+n[1]]}),[0,0]).map((function(t){return t*n}))},Vt=function(t){var n=Array(t[0].length).fill(1/0),r=Array(t[0].length).fill(-1/0);t.forEach((function(t){return t.forEach((function(t,e){t<n[e]&&(n[e]=t),t>r[e]&&(r[e]=t)}))}));var e=r.map((function(t,r){return t-n[r]}));return Mt.apply(void 0,_(e).concat(_(n)))},Kt=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=2*Math.PI/t/2,o=e/Math.cos(i);return Array.from(Array(Math.floor(t))).map((function(e,u){var c=-2*Math.PI*u/t+i;return[A(n+o*Math.sin(c),14),A(r+o*Math.cos(c),14)]}))},Qt=function(t,n,r,e){var i=r,o=[e[0]-r[0],e[1]-r[1]];return Dt(n,t,i,o,zt)},Wt=function(t,n,r){var e=t.map((function(t,e){return{type:"v",point:rt(r,n,t)?t:null,at_index:e}})).filter((function(t){return null!=t.point})),i=t.map((function(t,e,i){return{type:"e",point:Qt(n,r,t,i[(e+1)%i.length]),at_index:e}})).filter((function(t){return null!=t.point})),o=e.concat(i).sort((function(t,n){return Math.abs(t.point[0]-n.point[0])<S?t.point[1]-n.point[1]:t.point[0]-n.point[0]}));return console.log(o),t},tn=function(t,n,r){var e=t.map((function(t,e){return{point:rt(r,n,t)?t:null,at_index:e}})).filter((function(t){return null!=t.point})),i=t.map((function(t,e,i){return{point:Qt(n,r,t,i[(e+1)%i.length]),at_index:e}})).filter((function(t){return null!=t.point}));if(2==i.length){var o=i.slice().sort((function(t,n){return t.at_index-n.at_index})),u=t.slice(o[1].at_index+1).concat(t.slice(0,o[0].at_index+1));u.push(o[0].point),u.push(o[1].point);var c=t.slice(o[0].at_index+1,o[1].at_index+1);return c.push(o[1].point),c.push(o[0].point),[u,c]}if(1==i.length&&1==e.length){e[0].type="v",i[0].type="e";var a=e.concat(i).sort((function(t,n){return t.at_index-n.at_index})),s=t.slice(a[1].at_index+1).concat(t.slice(0,a[0].at_index+1));"e"===a[0].type&&s.push(a[0].point),s.push(a[1].point);var f=t.slice(a[0].at_index+1,a[1].at_index+1);return"e"===a[1].type&&f.push(a[1].point),f.push(a[0].point),[s,f]}if(2==e.length){var h=e.slice().sort((function(t,n){return t.at_index-n.at_index}));return[t.slice(h[1].at_index).concat(t.slice(0,h[0].at_index+1)),t.slice(h[0].at_index,h[1].at_index+1)]}return[t.slice()]},nn=function(t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S,r=1e4,e=t.slice().sort((function(t,r){return Math.abs(t[1]-r[1])<n?t[0]-r[0]:t[1]-r[1]})),i=[];i.push(e[0]);var o=0,u=0,c=function(){u+=1;var t=i.length-1,r=e.filter((function(r){return!(Math.abs(r[0]-i[t][0])<n&&Math.abs(r[1]-i[t][1])<n)})).map((function(n){for(var r=Math.atan2(i[t][1]-n[1],i[t][0]-n[0]);r<o;)r+=2*Math.PI;return{node:n,angle:r,distance:void 0}})).sort((function(t,n){return t.angle<n.angle?-1:t.angle>n.angle?1:0}));if(0===r.length)return{v:void 0};var c=r[0];if(r=r.filter((function(t){return Math.abs(c.angle-t.angle)<n})).map((function(n){var r=Math.sqrt(Math.pow(i[t][0]-n.node[0],2)+Math.pow(i[t][1]-n.node[1],2));return n.distance=r,n})).sort((function(t,n){return t.distance<n.distance?1:t.distance>n.distance?-1:0})),i.filter((function(t){return t===r[0].node})).length>0)return{v:i};i.push(r[0].node),o=Math.atan2(i[t][1]-r[0].node[1],i[t][0]-r[0].node[0])};do{var a=c();if("object"===d(a))return a.v}while(u<r)},rn=Object.freeze({__proto__:null,R2D:Zt,D2R:Tt,clockwise_angle2_radians:function(t,n){for(;t<0;)t+=2*Math.PI;for(;n<0;)n+=2*Math.PI;var r=t-n;return r>=0?r:2*Math.PI-(n-t)},counter_clockwise_angle2_radians:Jt,clockwise_angle2:function(t,n){var r=n[0]*t[0]+n[1]*t[1],e=n[0]*t[1]-n[1]*t[0],i=Math.atan2(e,r);return i<0&&(i+=2*Math.PI),i},counter_clockwise_angle2:Ct,counter_clockwise_vector_order:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var e=n.map((function(t){return Math.atan2(t[1],t[0])})),i=Array.from(Array(e.length)).map((function(t,n){return n})).sort((function(t,n){return e[t]-e[n]}));return i.slice(i.indexOf(0),i.length).concat(i.slice(0,i.indexOf(0)))},interior_angles2:function(t,n){var r=Ct(t,n);return[r,2*Math.PI-r]},interior_angles:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.map((function(t,n,r){return Ct(t,r[(n+1)%r.length])}))},bisect_vectors:Xt,bisect_lines2:Yt,subsect_radians:$t,subsect:function(t,n,r){var e=Math.atan2(n[1],n[0]),i=Math.atan2(r[1],r[0]);return $t(t,e,i).map((function(t){return[Math.cos(t),Math.sin(t)]}))},circumcircle:Bt,signed_area:Ht,centroid:Ut,enclosing_rectangle:Vt,make_regular_polygon:Kt,split_polygon:Wt,split_convex_polygon:tn,convex_hull:nn}),en=Object.freeze({__proto__:null,lerp:function(t,n,r){return t*(1-r)+n*r},cosine:function(t,n,r){var e=(1-Math.cos(r*Math.PI))/2;return t*(1-e)+n*e},cubic:function(t,n,r,e,i){var o=i*i,u=e-r-t+n;return u*i*o+(t-n-u)*o+(r-t)*i+n},catmull_rom:function(t,n,r,e,i){var o=i*i;return(-.5*t+1.5*n-1.5*r+.5*e)*i*o+(t-2.5*n+2*r-.5*e)*o+(-.5*t+.5*r)*i+n},hermite:function(t,n,r,e,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,c=i*i,a=c*i,s=(n-t)*(1+u)*(1-o)/2,f=(r-n)*(1+u)*(1-o)/2,h=2*a-3*c+1,l=a-2*c+i,p=a-c,v=-2*a+3*c;return h*n+l*(s+=(r-n)*(1-u)*(1-o)/2)+p*(f+=(e-r)*(1-u)*(1-o)/2)+v*r}}),on=function(t,n,r){for(var e,i=n.map((function(n,e){return{o:n,i:e,d:r(t,n)}})),o=1/0,u=0;u<i.length;u+=1)i[u].d<o&&(e=u,o=i[u].d);return e},un=function(t,n,r,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:S,o=Math.pow(t[0],2)+Math.pow(t[1],2),u=[0,1].map((function(t,e){return r[e]-n[e]})),c=[0,1].map((function(n,r){return t[r]*u[r]})).reduce((function(t,n){return t+n}),0),a=c/o,s=e(a,i);return[0,1].map((function(r,e){return n[e]+t[e]*s}))},cn=function(t){return t<-S?0:t>1+S?1:t},an=function(t,o,u){return e(o,r(n(i(u,o)),t))},sn=function(){return!1},fn=Object.freeze({__proto__:null,nearest_point2:function(t,n){var r=on(t,n,h);return void 0===r?void 0:n[r]},nearest_point:function(t,n){var r=on(t,n,l);return void 0===r?void 0:n[r]},nearest_point_on_line:un,nearest_point_on_polygon:function(t,n){var r=t.map((function(t,n,r){return i(r[(n+1)%r.length],t)}));return t.map((function(t,e){return un(r[e],t,n,cn)})).map((function(t,r){return{point:t,i:r,distance:l(t,n)}})).sort((function(t,n){return t.distance-n.distance})).shift()},nearest_point_on_circle:an,nearest_point_on_ellipse:sn}),hn=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return[0,1].map((function(t){return n.filter((function(n,r){return r%2===t})).reduce((function(t,n){return t+n}),0)}))},ln=function(){return hn.apply(void 0,arguments).map((function(t){return t<0?t+2*Math.PI:t})).map((function(t){return Math.PI-t}))},pn=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.map((function(t,n,r){return Jt(t,r[(n+1)%r.length])})).map((function(t,n,r){return r.slice(n+1,r.length).concat(r.slice(0,n))})).map((function(t){return ln.apply(void 0,_(t))})).map((function(t,r){return n[r]+t[0]})).map((function(t,r){return ct(t,n[r],n[(r+1)%n.length])?t:void 0}))},vn=Object.freeze({__proto__:null,alternating_sum:hn,kawasaki_sector_score:ln,kawasaki_solutions_radians:pn,kawasaki_solutions:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var e=n.map((function(t){return Math.atan2(t[1],t[0])}));return pn.apply(void 0,_(e)).map((function(t){return void 0===t?void 0:[A(Math.cos(t),14),A(Math.sin(t),14)]}))}}),gn=function(t){switch(t.constructor.name){case"vector":case"matrix":case"segment":case"ray":case"line":case"circle":case"ellipse":case"rect":case"polygon":return t.constructor.name}if("object"===d(t)){if(null!=t.radius)return"circle";if(null!=t.width)return"rect";if(null!=t.x)return"vector";if(null!=t.rotate180)return"ray";if(null!=t[0]&&t[0].length&&null!=t[0].x)return"segment";if(null!=t.vector&&null!=t.origin)return"line"}},mn=function(t){return t>=1?0:t<=-1?Math.PI:Math.acos(t)},dn=function(t,n,r){var e=n[0]-t[0],i=n[1]-t[1],o=e*Math.cos(r)+i*Math.sin(r),u=i*Math.cos(r)-e*Math.sin(r);return[t[0]+o,t[1]+u]},yn=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S,e=t.radius<n.radius?t.radius:n.radius,i=t.radius<n.radius?n.radius:t.radius,o=t.radius<n.radius?t.origin:n.origin,u=t.radius<n.radius?n.origin:t.origin,c=[o[0]-u[0],o[1]-u[1]],a=Math.sqrt(Math.pow(c[0],2)+Math.pow(c[1],2));if(!(a<r)){var s=c.map((function(t,n){return t/a*i+u[n]}));if(Math.abs(i+e-a)<r||Math.abs(i-(e+a))<r)return[s];if(!(a+e<i||i+e<a)){var f=mn((e*e-a*a-i*i)/(-2*a*i)),h=dn(u,s,+f),l=dn(u,s,-f);return[h,l]}}},_n=function(t,n,r,e,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:S,u=Math.pow(r[0],2)+Math.pow(r[1],2),c=Math.sqrt(u),a=0===c?r:r.map((function(t){return t/c})),s=[-a[1],a[0]],f=[e[0]-n[0],e[1]-n[1]],h=f[0]*a[1]-a[0]*f[1];if(!(Math.abs(h)>t+o)){var l=Math.sqrt(Math.pow(t,2)-Math.pow(h,2)),p=function(t,r){return n[r]-s[r]*h+a[r]*t},v=Math.abs(t-Math.abs(h))<o?[l].map((function(t){return[t,t].map(p)})):[-l,l].map((function(t){return[t,t].map(p)})),g=v.map((function(t){return t.map((function(t,n){return t-e[n]}))})).map((function(t){return t[0]*r[0]+r[1]*t[1]})).map((function(t){return t/u}));return v.filter((function(t,n){return i(g[n],o)}))}},Mn=function(){return!0},xn=function(t,n){return t>-n},bn=function(t,n){return t>-n&&t<1+n},wn=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S;return _n(t.radius,t.origin,n.vector,n.origin,Mn,r)},Pn=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S;return _n(t.radius,t.origin,n.vector,n.origin,xn,r)},An=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S;return _n(t.radius,t.origin,n.vector,n.origin,bn,r)},jn=Object.freeze({__proto__:null,circle_circle:yn,circle_line:wn,circle_ray:Pn,circle_segment:An}),On=function(t,n,r,e){var i={origin:t,vector:[[n[0]-t[0]],[n[1]-t[1]]]},o={origin:r,vector:[[e[0]-r[0]],[e[1]-r[1]]]};return Dt(i,o,Ft)},In=function(t,n){return Math.abs(t[0]-n[0])<S&&Math.abs(t[1]-n[1])<S},kn=function(t,n,r){var e=t.map((function(t,n,r){return[t,r[(n+1)%r.length]]})).map((function(t){return function(t,n,r,e){var i={origin:t,vector:n},o={origin:r,vector:[[e[0]-r[0]],[e[1]-r[1]]]};return Dt(i,o,It)}(r,n,t[0],t[1])})).filter((function(t){return null!=t}));switch(e.length){case 0:return;case 1:return[e[0],e[0]];case 2:return e;default:for(var i=1;i<e.length;i+=1)if(!In(e[0],e[i]))return[e[0],e[i]];return}},Sn=function(t,n,r){var e=t.map((function(t,n,r){return[t,r[(n+1)%r.length]]})).map((function(t){return function(t,n,r,e){var i={origin:t,vector:n},o={origin:r,vector:[[e[0]-r[0]],[e[1]-r[1]]]};return Dt(i,o,St)}(r,n,t[0],t[1])})).filter((function(t){return null!=t}));switch(e.length){case 0:return;case 1:return[r,e[0]];case 2:return In(e[0],e[1])?[r,e[0]]:e;default:for(var i=1;i<e.length;i+=1)if(!In(e[0],e[i]))return[e[0],e[i]];return}},En=function(t,n,r){var e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:S,i=t.map((function(t,n,r){return[t,r[(n+1)%r.length]]})).map((function(t){return On(n,r,t[0],t[1])})).filter((function(t){return null!=t})),o=ot(n,t,e),u=ot(r,t,e),c=it(n,t,e),a=it(r,t,e);if(0===i.length&&(o||u))return[n,r];if(0===i.length&&c&&a)return[n,r];switch(i.length){case 0:return o?[_(n),_(r)]:void 0;case 1:return c?[_(n),i[0]]:[_(r),i[0]];case 2:return i;default:throw new Error("clipping segment in a convex polygon resulting in 3 or more points")}},qn=Object.freeze({__proto__:null,determ2:function(t,n){return t[0]*n[1]-n[0]*t[1]},convex_poly_circle:function(t,n,r){return[]},convex_poly_line:kn,convex_poly_ray:Sn,convex_poly_segment:En,convex_poly_ray_exclusive:function(t,n,r){var e=t.map((function(t,n,r){return[t,r[(n+1)%r.length]]})).map((function(t){return ray_segment_exclusive(r,n,t[0],t[1])})).filter((function(t){return null!=t}));switch(e.length){case 0:return;case 1:return[r,e[0]];case 2:return e;default:for(var i=1;i<e.length;i+=1)if(!In(e[0],e[i]))return[e[0],e[i]];return}}}),zn={circle:{circle:yn,line:wn,ray:Pn,segment:An},line:{poly:function(t,n){return kn(n,t)},circle:function(t,n){return wn(n,t)},line:function(t,n){return Dt(t,n,jt)},ray:function(t,n,r){return Dt(t,n,!1===r?qt:Ot)},segment:function(t,n,r){return Dt(t,n,!1===r?zt:It)}},ray:{poly:function(t,n){return Sn(n,t)},circle:function(t,n){return Pn(n,t)},line:function(t,n,r){return Dt(n,t,!1===r?qt:Ot)},ray:function(t,n,r){return Dt(t,n,!1===r?Nt:kt)},segment:function(t,n,r){return Dt(t,n,!1===r?Gt:St)}},segment:{poly:function(t,n){return En(n,t)},circle:function(t,n){return An(n,t)},line:function(t,n,r){return Dt(n,t,!1===r?zt:It)},ray:function(t,n,r){return Dt(n,t,!1===r?Gt:St)},segment:function(t,n,r){return Dt(t,n,!1===r?Ft:Et)}}},Nn=function(t,n,r){var e=gn(t),i=gn(n);return zn[e][i](t,n,r)},Gn={preserve:{magnitude:function(){return t(this)},isEquivalent:function(){return N(this,mt(arguments))},isParallel:function(){return tt.apply(void 0,_(w(this,mt(arguments))))},dot:function(){return o.apply(void 0,_(w(this,mt(arguments))))},distanceTo:function(){return l.apply(void 0,_(w(this,mt(arguments))))}},vector:{copy:function(){return _(this)},normalize:function(){return n(this)},scale:function(){return r(this,arguments[0])},flip:function(){return p(this)},rotate90:function(){return v(this)},rotate270:function(){return g(this)},cross:function(){return f(b(3,this),b(3,mt(arguments)))},transform:function(){return L(Pt(arguments),b(3,this))},add:function(){return e(this,b(this.length,mt(arguments)))},subtract:function(){return i(this,b(this.length,mt(arguments)))},rotateZ:function(t,n){return L(Pt(lt(t,n)),this)},lerp:function(t,n){return a(this,b(this.length,mt(t)),n)},midpoint:function(){return u.apply(void 0,_(w(this,mt(arguments))))},bisect:function(){return Xt(this,mt(arguments))}}},Fn={};Object.keys(Gn.preserve).forEach((function(t){Fn[t]=Gn.preserve[t]})),Object.keys(Gn.vector).forEach((function(t){Fn[t]=function(){return st.vector.apply(st,_(Gn.vector[t].apply(this,arguments)))}}));var Ln={fromAngle:function(t){return st.vector(Math.cos(t),Math.sin(t))},fromAngleDegrees:function(t){return st.vector.fromAngle(t*Tt)}},Dn={vector:{P:Array.prototype,A:function(){var t=this;mt(arguments).forEach((function(n){return t.push(n)}))},G:{x:function(){return this[0]},y:function(){return this[1]},z:function(){return this[2]}},M:Fn,S:Ln}},Rn=function(){};Rn.prototype.isParallel=function(){var t=w(this.vector,_t.apply(void 0,arguments).vector);return console.log(arguments,this.vector,_t.apply(void 0,arguments).vector,t),tt.apply(void 0,_(t))},Rn.prototype.isDegenerate=function(){return W(this.vector)},Rn.prototype.reflection=function(){return st.matrix(pt(this.vector,this.origin))},Rn.prototype.nearestPoint=function(){var t=mt(arguments);return st.vector(un(this.vector,this.origin,t,this.clip_function))},Rn.prototype.transform=function(){var t=this.dimension,n=D(Pt(arguments),b(3,this.vector),b(3,this.origin));return this.constructor(b(t,n.vector),b(t,n.origin))},Rn.prototype.intersect=function(t){return Nn(this,t)},Rn.prototype.bisect=function(){var t=_t(arguments);return Yt(this.vector,this.origin,t.vector,t.origin)},Object.defineProperty(Rn.prototype,"dimension",{get:function(){return[this.vector,this.origin].map((function(t){return t.length})).reduce((function(t,n){return Math.max(t,n)}),0)}});var Zn={fromPoints:function(){var t=dt(arguments);return this.constructor({vector:i(t[1],t[0]),origin:t[0]})},perpendicularBisector:function(){var t=dt(arguments);return this.constructor({vector:v(i(t[1],t[0])),origin:c(t[0],t[1])})}},Tn={line:{P:Rn.prototype,A:function(){var t=_t.apply(void 0,arguments);this.vector=st.vector(t.vector),this.origin=st.vector(b(this.vector.length,t.origin))},G:{length:function(){return 1/0}},M:{clip_function:function(t){return t},path:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,n=this.origin.add(this.vector.scale(-t)),r=this.vector.scale(2*t);return"M".concat(n[0]," ").concat(n[1],"l").concat(r[0]," ").concat(r[1])}},S:Zn}},Jn={ray:{P:Rn.prototype,A:function(){var t=_t.apply(void 0,arguments);this.vector=st.vector(t.vector),this.origin=st.vector(b(this.vector.length,t.origin))},G:{length:function(){return 1/0}},M:{rotate180:function(){return st.ray(this.origin[0],this.origin[1],-this.vector[0],-this.vector[1])},clip_function:function(t){return t<-S?0:t},path:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,n=this.vector.scale(t);return"M".concat(this.origin[0]," ").concat(this.origin[1],"l").concat(n[0]," ").concat(n[1])}},S:Zn}},Cn={segment:{P:Rn.prototype,A:function(){var t=yt.apply(void 0,arguments);this.points=[st.vector(t[0]),st.vector(t[1])],this.vector=this.points[1].subtract(this.points[0]),this.origin=this.points[0]},G:{0:function(){return this.points[0]},1:function(){return this.points[1]},length:function(){return this.vector.magnitude()}},M:{clip_function:function(t){return t<-S?0:t>1+S?1:t},transform:function(){for(var t=this.dimension,n=arguments.length,r=new Array(n),e=0;e<n;e++)r[e]=arguments[e];var i=Pt(r),o=this.points.map((function(t){return b(3,t)})).map((function(t){return L(i,t)})).map((function(n){return b(t,n)}));return st.segment(o)},scale:function(t){var n=c(this.points[0],this.points[1]),r=this.points.map((function(r){return r.lerp(n,t)}));return st.segment(r)},midpoint:function(){return st.vector(c(this.points[0],this.points[1]))},svgPath:function(){var t=this.points.map((function(t){return"".concat(t[0]," ").concat(t[1])}));return["M","L"].map((function(n,r){return"".concat(n).concat(t[r])})).join("")}},S:{fromPoints:function(){return this.constructor.apply(this,arguments)}}}},Xn=function(t,n,r,e,i,o){var u=Math.cos(i),c=Math.sin(i),a=Math.cos(o),s=Math.sin(o);return[t+u*r*a+-c*e*s,n+c*r*a+u*e*s]},Yn=function(t,n,r,e,i,o,u){var c=o;if(c<0&&!isNaN(c))for(;c<0;)c+=2*Math.PI;var a=u>2*Math.PI?2*Math.PI:u,s=Xn(t,n,r,e,i,c),f=Xn(t,n,r,e,i,c+a/2),h=Xn(t,n,r,e,i,c+a),l=a/2>Math.PI?1:0,p=a/2>0?1:0;return{x1:s[0],y1:s[1],x2:f[0],y2:f[1],x3:h[0],y3:h[1],fa:l,fs:p}},$n=function(t){return A(t,4)},Bn=function(t,n,r,e,i,o,u){return"A".concat($n(t)," ").concat($n(n)," ").concat($n(r)," ").concat($n(e)," ").concat($n(i)," ").concat($n(o)," ").concat($n(u))},Hn={circle:{A:function(){var t=dt(arguments),n=b(3,I(arguments));2===t.length?(this.radius=h.apply(void 0,_(t)),this.origin=st.vector.apply(st,_(t[0]))):(this.radius=n[0],this.origin=st.vector(n[1],n[2]))},G:{x:function(){return this.origin[0]},y:function(){return this.origin[1]}},M:{nearestPoint:function(){return st.vector(an(this.radius,this.origin,mt(arguments)))},intersect:function(t){return Nn(this,t)},svgPath:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2*Math.PI,r=Yn(this.origin[0],this.origin[1],this.radius,this.radius,0,t,n),e=Bn(this.radius,this.radius,0,r.fa,r.fs,r.x2,r.y2),i=Bn(this.radius,this.radius,0,r.fa,r.fs,r.x3,r.y3);return"M".concat(r.x1," ").concat(r.y1).concat(e).concat(i)},points:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128;return Array.from(Array(n)).map((function(t,r){return 2*Math.PI/n*r})).map((function(n){return[t.origin[0]+t.radius*Math.cos(n),t.origin[1]+t.radius*Math.sin(n)]}))},polygon:function(){return st.polygon(this.points(arguments[0]))},segments:function(){var t=this.points(arguments[0]);return t.map((function(n,r){var e=(r+1)%t.length;return[n,t[e]]}))}},S:{fromPoints:function(){return this.constructor.apply(this,arguments)},fromThreePoints:function(){var t=Bt.apply(void 0,arguments);return this.constructor.apply(this,_(t.origin).concat([t.radius]))}}}},Un=function(t,n,r,e){var i=n>r,o=i?Math.pow(n,2)-Math.pow(r,2):Math.pow(r,2)-Math.pow(n,2),u=Math.sqrt(o),c=i?Math.cos(e):Math.sin(e),a=i?Math.sin(e):Math.cos(e);return[st.vector(t[0]+u*c,t[1]+u*a),st.vector(t[0]-u*c,t[1]-u*a)]},Vn={ellipse:{A:function(){var t=I(arguments).filter((function(t){return!isNaN(t)})),n=b(5,t);this.rx=n[0],this.ry=n[1],this.origin=st.vector(n[2],n[3]),this.spin=n[4],this.foci=Un(this.origin,this.rx,this.ry,this.spin)},G:{x:function(){return this.origin[0]},y:function(){return this.origin[1]}},M:{nearestPoint:function(){return st.vector((this.origin,this.radius,mt(arguments),!1))},intersect:function(t){return Nn(this,t)},svgPath:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2*Math.PI,r=Yn(this.origin[0],this.origin[1],this.rx,this.ry,this.spin,t,n),e=Bn(this.rx,this.ry,this.spin/Math.PI*180,r.fa,r.fs,r.x2,r.y2),i=Bn(this.rx,this.ry,this.spin/Math.PI*180,r.fa,r.fs,r.x3,r.y3);return"M".concat(r.x1," ").concat(r.y1).concat(e).concat(i)},points:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128;return Array.from(Array(n)).map((function(t,r){return 2*Math.PI/n*r})).map((function(n){return Xn(t.origin.x,t.origin.y,t.rx,t.ry,t.spin,n)}))},polygon:function(){return st.polygon(this.points(arguments[0]))},segments:function(){var t=this.points(arguments[0]);return t.map((function(n,r){var e=(r+1)%t.length;return[n,t[e]]}))}},S:{}}},Kn={area:function(){return Ht(this.points)},centroid:function(){return st.vector(Ut(this.points))},enclosingRectangle:function(){return st.rect(Vt(this.points))},contains:function(){return et(mt(arguments),this.points)},scale:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ut(this.points),r=this.points.map((function(t){return[0,1].map((function(r,e){return t[e]-n[e]}))})).map((function(r){return r.map((function(e,i){return n[i]+r[i]*t}))}));return this.constructor.fromPoints(r)},rotate:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ut(this.points),r=this.points.map((function(r){var e=[r[0]-n[0],r[1]-n[1]],i=Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)),o=Math.atan2(e[1],e[0]);return[n[0]+Math.cos(o+t)*i,n[1]+Math.sin(o+t)*i]}));return st.polygon(r)},translate:function(){var t=mt(arguments),n=this.points.map((function(n){return n.map((function(n,r){return n+t[r]}))}));return this.constructor.fromPoints(n)},transform:function(){var t=Pt(arguments),n=this.points.map((function(n){return L(t,b(3,n))}));return st.polygon(n)},sectors:function(){return this.points.map((function(t,n,r){var e=(n+r.length-1)%r.length,i=(n+1)%r.length,o=t,u=r[e].map((function(t,n){return t-o[n]})),c=r[i].map((function(t,n){return t-o[n]}));return st.sector(c,u,o)}))},nearest:function(){var t,n=mt(arguments),r=this.sides.map((function(t){return t.nearestPoint(n)})),e=1/0;return r.map((function(t){return h(n,t)})).forEach((function(n,r){n<e&&(e=n,t=r)})),{point:r[t],edge:this.sides[t]}},overlaps:function(){var t=O(arguments);return ut(this.points,t)},split:function(){var t=_t(arguments),n=this.convex?tn:Wt;return n(this.points,t.vector,t.origin).map((function(t){return st.polygon(t)}))},clipSegment:function(){var t=yt(arguments),n=En(this.points,t[0],t[1]);return void 0===n?void 0:st.segment(n)},clipLine:function(){var t=_t(arguments),n=kn(this.points,t.vector,t.origin);return void 0===n?void 0:st.segment(n)},clipRay:function(){var t=_t(arguments),n=Sn(this.points,t.vector,t.origin);return void 0===n?void 0:st.segment(n)},svgPath:function(){var t=Array(this.points.length).fill("L");return t[0]="M","".concat(this.points.map((function(n,r){return"".concat(t[r]).concat(n[0]," ").concat(n[1])})).join(""),"z")}},Qn=function(){this.points=[]};Object.keys(Kn).forEach((function(t){Qn.prototype[t]=Kn[t]}));var Wn=function(t){return[[t.x,t.y],[t.x+t.width,t.y],[t.x+t.width,t.y+t.height],[t.x,t.y+t.height]]},tr={rect:{P:Qn.prototype,A:function(){var t=xt.apply(void 0,arguments);this.width=t.width,this.height=t.height,this.origin=st.vector(t.x,t.y),this.points=Wn(this)},G:{x:function(){return this.origin[0]},y:function(){return this.origin[1]}},M:{area:function(){return this.width*this.height},segments:function(){return[[[(t=this).x,t.y],[t.x+t.width,t.y]],[[t.x+t.width,t.y],[t.x+t.width,t.y+t.height]],[[t.x+t.width,t.y+t.height],[t.x,t.y+t.height]],[[t.x,t.y+t.height],[t.x,t.y]]];var t}},S:{fromPoints:function(){return st.rect(Vt(dt(arguments)))}}}},nr={polygon:{P:Qn.prototype,A:function(){this.points=O(arguments),this.sides=this.points.map((function(t,n,r){return[t,r[(n+1)%r.length]]}))},G:{isConvex:function(){return!0},edges:function(){return this.sides}},M:{segments:function(){return this.sides}},S:{fromPoints:function(){return this.constructor.apply(this,arguments)},regularPolygon:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return this.constructor(Kt(t,n,r,e))},convexHull:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.constructor(nn(t,n))}}}},rr=function(t,n){for(var r=0;r<12;r+=1)t[r]=n[r];return t},er={matrix:{P:Array.prototype,A:function(){var t=this;[1,0,0,0,1,0,0,0,1,0,0,0].forEach((function(n){return t.push(n)}))},G:{},M:{copy:function(){return st.matrix.apply(st,_(Array.from(this)))},set:function(){return rr(this,Pt(arguments))},isIdentity:function(){return nt(this)},multiply:function(t){return rr(this,R(this,t))},determinant:function(){return Z(this)},inverse:function(){return rr(this,T(this))},translate:function(t,n,r){return rr(this,R(this,J(t,n,r)))},rotateX:function(t){return rr(this,R(this,C(t)))},rotateY:function(t){return rr(this,R(this,X(t)))},rotateZ:function(t){return rr(this,R(this,Y(t)))},rotate:function(t,n,r){var e=$(t,n,r);return rr(this,R(this,e))},scale:function(t){return rr(this,R(this,B(t)))},reflectZ:function(t,n){var r=H(t,n);return rr(this,R(this,r))},transform:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return st.vector(L(mt(n),this))},transformVector:function(t){return st.vector(L(this,t))},transformLine:function(t,n){return st.line(D(this,t,n))}},S:{}}},ir={plane:{A:function(){var t=dt.apply(void 0,arguments);this.normal=st.vector(t.length>0?t[0]:null),this.origin=st.vector(t.length>1?t[1]:null)},G:{point:function(){return this.origin}},M:{flip:function(){this.normal=this.normal.flip()},intersect:function(t){return Nn(this,t)}},S:{fromPoints:function(){},fromLine:function(){var t=_t(arguments);return this.constructor(t.vector,t.origin)},fromRay:function(){var t=_t(arguments);return this.constructor(t.vector,t.origin)}}}},or=Object.assign({},Dn,Tn,Jn,Cn,Hn,Vn,tr,nr,er,ir),ur=function(t,n){var r=Object.create(or[t].proto);return or[t].A.apply(r,n),r};Object.assign(st,{vector:function(){return ur("vector",arguments)},circle:function(){return ur("circle",arguments)},ellipse:function(){return ur("ellipse",arguments)},rect:function(){return ur("rect",arguments)},polygon:function(){return ur("polygon",arguments)},line:function(){return ur("line",arguments)},ray:function(){return ur("ray",arguments)},segment:function(){return ur("segment",arguments)},matrix:function(){return ur("matrix",arguments)},plane:function(){return ur("plane",arguments)}}),Object.keys(or).forEach((function(t){var n={};n.prototype=null!=or[t].P?Object.create(or[t].P):Object.create(Object.prototype),n.prototype.constructor=n,st[t].prototype=n.prototype,st[t].prototype.constructor=st[t],Object.keys(or[t].G).forEach((function(r){return Object.defineProperty(n.prototype,r,{get:or[t].G[r]})})),Object.keys(or[t].M).forEach((function(r){return Object.defineProperty(n.prototype,r,{value:or[t].M[r]})})),Object.keys(or[t].S).forEach((function(n){return Object.defineProperty(st[t],n,{value:or[t].S[n].bind(st[t].prototype)})})),or[t].proto=n.prototype})),st.__prototypes__={},Object.keys(or).forEach((function(t){st.__prototypes__[t]=or[t].proto}));var cr=st;return cr.core=Object.assign({},m,G,rn,en,vt,U,fn,at,At,k,vn),cr.typeof=gn,cr.intersect=Nn,cr.intersect.circle=jn,cr.intersect.lines=Rt,cr.intersect.polygon=qn,cr}));
