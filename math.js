!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self).math=n()}(this,(function(){"use strict";function t(n){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}function n(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],e=!0,i=!1,o=void 0;try{for(var u,c=t[Symbol.iterator]();!(e=(u=c.next()).done)&&(r.push(u.value),!n||r.length!==n);e=!0);}catch(t){i=!0,o=t}finally{try{e||null==c.return||c.return()}finally{if(i)throw o}}return r}(t,n)||e(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||e(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,n){if(t){if("string"==typeof t)return i(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(t,n):void 0}}function i(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}var o=function(t,n){return n.length===t?n:Array(t).fill(0).map((function(t,r){return n[r]?n[r]:t}))},u=function(t,n){var r=t.length>n.length?t.length:n.length;return[t,n].map((function(t){return o(r,t)}))},c=function(t){var n="".concat(t).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return n?Math.max(0,(n[1]?n[1].length:0)-(n[2]?+n[2]:0)):0},a=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15;if("number"!=typeof t)return t;var r=parseFloat(t.toFixed(n));return c(r)===Math.min(n,c(t))?t:r},s=function(t){return null!=t&&"function"==typeof t[Symbol.iterator]},f=function t(){switch(arguments.length){case void 0:case 0:return Array.from(arguments);case 1:return s(arguments[0])&&"string"!=typeof arguments[0]?t.apply(void 0,r(arguments[0])):[arguments[0]];default:return Array.from(arguments).map((function(n){return s(n)?r(t(n)):n}))}},l=function t(){switch(arguments.length){case void 0:case 0:return Array.from(arguments);case 1:return s(arguments[0])&&"string"!=typeof arguments[0]?t.apply(void 0,r(arguments[0])):[arguments[0]];default:return Array.from(arguments).map((function(n){return s(n)?r(t(n)):n})).reduce((function(t,n){return t.concat(n)}),[])}},h=Object.freeze({__proto__:null,resize:o,resize_up:u,resize_down:function(t,n){var r=t.length>n.length?n.length:t.length;return[t,n].map((function(t){return o(r,t)}))},clean_number:a,semi_flatten_arrays:f,flatten_arrays:l}),v=1e-6,p=function(t,n){return t===n},g=function(t,n){return Math.abs(t-n)<v},d=function(t,n){return Array.from(Array(t.length-1)).map((function(r,e){return n(t[0],t[e+1])})).reduce((function(t,n){return t&&n}),!0)},_=function(){var t=Array.from(arguments),n=t.map((function(t){return t.length})).reduce((function(t,n){return t>n?t:n})),r=t.map((function(t){return o(n,t)}));return Array.from(Array(arguments.length-1)).map((function(t,n){return r[0].map((function(t,e){return Math.abs(r[0][e]-r[n+1][e])<v})).reduce((function(t,n){return t&&n}),!0)})).reduce((function(t,n){return t&&n}),!0)},y=Object.freeze({__proto__:null,EPSILON:v,equivalent_vec2:function(t,n){return Math.abs(t[0]-n[0])<v&&Math.abs(t[1]-n[1])<v},equivalent_arrays_of_numbers:function(){},equivalent_numbers:function t(){return 0!==arguments.length&&(1===arguments.length&&void 0!==arguments[0]?t.apply(void 0,r(arguments[0])):d(arguments,g))},equivalent_vectors:_,equivalent:function(){var n=f.apply(void 0,arguments);if(n.length<1)return!1;var e=t(n[0]);if("undefined"===e)return!1;switch(e){case"number":return d(n,g);case"boolean":case"string":return d(n,p);case"object":return n[0].constructor===Array?_.apply(void 0,r(n)):d(n,(function(t,n){return JSON.stringify(t)===JSON.stringify(n)}));default:return}}}),m=function(t){return t*t},M=function(t,n){return t+n},x=function(t){return Math.sqrt(t.map(m).reduce(M,0))},b=function(t){return t.map(m).reduce(M,0)},w=function(t){var n=x(t);return 0===n?t:t.map((function(t){return t/n}))},A=function(t,n){return t.map((function(t){return t*n}))},j=function(t,n){return t.map((function(t,r){return t+n[r]}))},O=function(t,n){return t.map((function(t,r){return t-n[r]}))},P=function(t,n){return t.map((function(r,e){return t[e]*n[e]})).reduce(M,0)},S=function(t,n){return t.map((function(t,r){return(t+n[r])/2}))},k=function(){var t=arguments;if(0===arguments.length)return[];var n=arguments[0].length>0?arguments[0].length:0,r=Array(n).fill(0);return Array.from(arguments).forEach((function(t){return r.forEach((function(n,e){r[e]+=t[e]||0}))})),r.map((function(n){return n/t.length}))},z=function(t,n,r){var e=1-r;return t.map((function(t,i){return t*e+n[i]*r}))},I=function(t,n){return t[0]*n[1]-t[1]*n[0]},q=function(t,n){return[t[1]*n[2]-t[2]*n[1],t[0]*n[2]-t[2]*n[0],t[0]*n[1]-t[1]*n[0]]},E=function(t,n){var r=t[0]-n[0],e=t[1]-n[1];return Math.sqrt(r*r+e*e)},N=function(t,n){return Math.sqrt(t.map((function(r,e){return Math.pow(t[e]-n[e],2)})).reduce((function(t,n){return t+n}),0))},G=function(t){return t.map((function(t){return-t}))},F=function(t){return[-t[1],t[0]]},T=function(t){return[t[1],-t[0]]},L=function(t){return Math.abs(t.reduce((function(t,n){return t+n}),0))<v},Z=function(t,n){return 1-Math.abs(P(w(t),w(n)))<v},R=Object.freeze({__proto__:null,magnitude:x,mag_squared:b,normalize:w,scale:A,add:j,subtract:O,dot:P,midpoint:S,average:k,lerp:z,cross2:I,cross3:q,distance2:E,distance3:function(t,n){var r=t[0]-n[0],e=t[1]-n[1],i=t[2]-n[2];return Math.sqrt(r*r+e*e+i*i)},distance:N,flip:G,rotate90:F,rotate270:T,degenerate:L,parallel:Z}),D=Object.create(null),C=[1,0,0,1],J=C.concat(0,0),X=function(t){return t[0]*t[3]-t[1]*t[2]},Y=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],r=Math.cos(t),e=Math.sin(t);return[r,e,-e,r,n[0],n[1]]},$=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],r=Math.atan2(t[1],t[0]),e=Math.cos(r),i=Math.sin(r),o=Math.cos(-r),u=Math.sin(-r),c=e*o+i*u,a=e*-u+i*o,s=i*o+-e*u,f=i*-u+-e*o,l=n[0]+c*-n[0]+-n[1]*s,h=n[1]+a*-n[0]+-n[1]*f;return[c,a,s,f,l,h]},B=Object.freeze({__proto__:null,identity2x2:C,identity2x3:J,multiply_matrix2_vector2:function(t,n){return[t[0]*n[0]+t[2]*n[1]+t[4],t[1]*n[0]+t[3]*n[1]+t[5]]},multiply_matrix2_line2:function(t,n,r){return{vector:[t[0]*n[0]+t[2]*n[1],t[1]*n[0]+t[3]*n[1]],origin:[t[0]*r[0]+t[2]*r[1]+t[4],t[1]*r[0]+t[3]*r[1]+t[5]]}},multiply_matrices2:function(t,n){return[t[0]*n[0]+t[2]*n[1],t[1]*n[0]+t[3]*n[1],t[0]*n[2]+t[2]*n[3],t[1]*n[2]+t[3]*n[3],t[0]*n[4]+t[2]*n[5]+t[4],t[1]*n[4]+t[3]*n[5]+t[5]]},determinant2:X,invert_matrix2:function(t){var n=X(t);if(!(Math.abs(n)<1e-6||isNaN(n))&&isFinite(t[4])&&isFinite(t[5]))return[t[3]/n,-t[1]/n,-t[2]/n,t[0]/n,(t[2]*t[5]-t[3]*t[4])/n,(t[1]*t[4]-t[0]*t[5])/n]},make_matrix2_translate:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return C.concat(t,n)},make_matrix2_scale:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0];return[t,0,0,n,t*-r[0]+r[0],n*-r[1]+r[1]]},make_matrix2_rotate:Y,make_matrix2_reflect:$}),H=Object.freeze([1,0,0,0,1,0,0,0,1]),U=Object.freeze(H.concat(0,0,0)),V=function(t){return U.map((function(n,r){return Math.abs(n-t[r])<v})).reduce((function(t,n){return t&&n}),!0)},W=function(t,n){return[t[0]*n[0]+t[3]*n[1]+t[6]*n[2]+t[9],t[1]*n[0]+t[4]*n[1]+t[7]*n[2]+t[10],t[2]*n[0]+t[5]*n[1]+t[8]*n[2]+t[11]]},K=function(t,n,r){return{vector:[t[0]*n[0]+t[3]*n[1]+t[6]*n[2],t[1]*n[0]+t[4]*n[1]+t[7]*n[2],t[2]*n[0]+t[5]*n[1]+t[8]*n[2]],origin:[t[0]*r[0]+t[3]*r[1]+t[6]*r[2]+t[9],t[1]*r[0]+t[4]*r[1]+t[7]*r[2]+t[10],t[2]*r[0]+t[5]*r[1]+t[8]*r[2]+t[11]]}},Q=function(t,n){return[t[0]*n[0]+t[3]*n[1]+t[6]*n[2],t[1]*n[0]+t[4]*n[1]+t[7]*n[2],t[2]*n[0]+t[5]*n[1]+t[8]*n[2],t[0]*n[3]+t[3]*n[4]+t[6]*n[5],t[1]*n[3]+t[4]*n[4]+t[7]*n[5],t[2]*n[3]+t[5]*n[4]+t[8]*n[5],t[0]*n[6]+t[3]*n[7]+t[6]*n[8],t[1]*n[6]+t[4]*n[7]+t[7]*n[8],t[2]*n[6]+t[5]*n[7]+t[8]*n[8],t[0]*n[9]+t[3]*n[10]+t[6]*n[11]+t[9],t[1]*n[9]+t[4]*n[10]+t[7]*n[11]+t[10],t[2]*n[9]+t[5]*n[10]+t[8]*n[11]+t[11]]},tt=function(t){return t[0]*t[4]*t[8]-t[0]*t[7]*t[5]-t[3]*t[1]*t[8]+t[3]*t[7]*t[2]+t[6]*t[1]*t[5]-t[6]*t[4]*t[2]},nt=function(t){var n=tt(t);if(!(Math.abs(n)<1e-6||isNaN(n))&&isFinite(t[9])&&isFinite(t[10])&&isFinite(t[11])){var r=[t[4]*t[8]-t[7]*t[5],-t[1]*t[8]+t[7]*t[2],t[1]*t[5]-t[4]*t[2],-t[3]*t[8]+t[6]*t[5],t[0]*t[8]-t[6]*t[2],-t[0]*t[5]+t[3]*t[2],t[3]*t[7]-t[6]*t[4],-t[0]*t[7]+t[6]*t[1],t[0]*t[4]-t[3]*t[1],-t[3]*t[7]*t[11]+t[3]*t[8]*t[10]+t[6]*t[4]*t[11]-t[6]*t[5]*t[10]-t[9]*t[4]*t[8]+t[9]*t[5]*t[7],t[0]*t[7]*t[11]-t[0]*t[8]*t[10]-t[6]*t[1]*t[11]+t[6]*t[2]*t[10]+t[9]*t[1]*t[8]-t[9]*t[2]*t[7],-t[0]*t[4]*t[11]+t[0]*t[5]*t[10]+t[3]*t[1]*t[11]-t[3]*t[2]*t[10]-t[9]*t[1]*t[5]+t[9]*t[2]*t[4]],e=1/n;return r.map((function(t){return t*e}))}},rt=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return H.concat(t,n,r)},et=function(t,n,r,e,i){var o=H.concat([0,1,2].map((function(t){return n[t]||0}))),u=Math.cos(t),c=Math.sin(t);return o[3*r+r]=u,o[3*r+e]=(i?1:-1)*c,o[3*e+r]=(i?-1:1)*c,o[3*e+e]=u,o},it=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return et(t,n,1,2,!0)},ot=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return et(t,n,0,2,!1)},ut=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return et(t,n,0,1,!0)},ct=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0],i=o(3,w(r)),u=[0,1,2].map((function(t){return e[t]||0})),c=n(i,3),a=c[0],s=c[1],f=c[2],l=Math.cos(t),h=Math.sin(t),v=Math.sqrt(i[1]*i[1]+i[2]*i[2]),p=Math.abs(v)<1e-6?0:s/v,g=Math.abs(v)<1e-6?1:f/v,d=H.concat(-u[0],-u[1],-u[2]),_=H.concat(u[0],u[1],u[2]),y=[1,0,0,0,g,p,0,-p,g,0,0,0],m=[1,0,0,0,g,-p,0,p,g,0,0,0],M=[v,0,a,0,1,0,-a,0,v,0,0,0],x=[v,0,-a,0,1,0,a,0,v,0,0,0],b=[l,h,0,-h,l,0,0,0,1,0,0,0];return Q(_,Q(m,Q(x,Q(b,Q(M,Q(y,d))))))},at=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return[t,0,0,0,t,0,0,0,t,t*-n[0]+n[0],t*-n[1]+n[1],t*-n[2]+n[2]]},st=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],r=Math.atan2(t[1],t[0]),e=Math.cos(r),i=Math.sin(r),o=Math.cos(-r),u=Math.sin(-r),c=e*o+i*u,a=e*-u+i*o,s=i*o+-e*u,f=i*-u+-e*o,l=n[0]+c*-n[0]+-n[1]*s,h=n[1]+a*-n[0]+-n[1]*f;return[c,a,0,s,f,0,0,0,0,l,h,0]},ft=Object.freeze({__proto__:null,identity3x3:H,identity3x4:U,is_identity3x4:V,multiply_matrix3_vector3:W,multiply_matrix3_line3:K,multiply_matrices3:Q,determinant3:tt,invert_matrix3:nt,make_matrix3_translate:rt,make_matrix3_rotateX:it,make_matrix3_rotateY:ot,make_matrix3_rotateZ:ut,make_matrix3_rotate:ct,make_matrix3_scale:at,make_matrix3_reflectZ:st}),lt=function(t,n){return{vector:t||[],origin:n||[]}},ht=function(){if(arguments[0]instanceof D.vector)return arguments[0];var n=l(arguments);return n.length>0&&"object"===t(n[0])&&null!==n[0]&&!isNaN(n[0].x)&&(n=["x","y","z"].map((function(t){return n[0][t]})).filter((function(t){return void 0!==t}))),n.filter((function(t){return"number"==typeof t}))},vt=function(){return f(arguments).map((function(t){return ht(t)}))},pt=function(){if(arguments[0]instanceof D.segment)return arguments[0];var t=f(arguments);return 4===t.length?[[t[0],t[1]],[t[2],t[3]]]:vt(t)},gt=function(){var t=f(arguments);return 0===t.length?lt([],[]):t[0]instanceof D.line||t[0]instanceof D.ray||t[0]instanceof D.segment?t[0]:t[0].constructor===Object?lt(t[0].vector||[],t[0].origin||[]):"number"==typeof t[0]?lt(ht(t)):lt.apply(void 0,r(t.map((function(t){return ht(t)}))))},dt=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return{x:t,y:n,width:r,height:e}},_t=function(){if(arguments[0]instanceof D.rect)return arguments[0];var n=l(arguments);if(n.length>0&&"object"===t(n[0])&&null!==n[0]&&!isNaN(n[0].width))return dt.apply(void 0,r(["x","y","width","height"].map((function(t){return n[0][t]})).filter((function(t){return void 0!==t}))));var e=n.filter((function(t){return"number"==typeof t})),i=e.length<4?[,,].concat(r(e)):e;return dt.apply(void 0,r(i))},yt=[[0,1,3,4,9,10],[0,1,2,3,4,5,6,7,8,9,10,11],[0,1,2,void 0,3,4,5,void 0,6,7,8,void 0,9,10,11]];[11,7,3].forEach((function(t){return delete yt[2][t]}));var mt=function(t){return yt[t<8?0:t<13?1:2]},Mt=function(){var t=l(arguments),n=r(U);return mt(t.length).forEach((function(r,e){null!=t[e]&&(n[r]=t[e])})),n},xt=Object.freeze({__proto__:null,get_vector:ht,get_vector_of_vectors:vt,get_segment:pt,get_line:gt,rect_form:dt,get_rect:_t,get_matrix_3x4:Mt,get_matrix2:function(){var t=ht(arguments);return 6===t.length?t:t.length>6?[t[0],t[1],t[2],t[3],t[4],t[5]]:t.length<6?J.map((function(n,r){return t[r]||n})):void 0}}),bt=function(){return!0},wt=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v;return t>-n},At=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v;return t>-n&&t<1+n},jt=function(){return!0},Ot=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v;return t>n},Pt=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v;return t>n&&t<1-n},St=function(){return!0},kt=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v;return n>-r},zt=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v;return n>-r&&n<1+r},It=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v;return t>-r&&n>-r},qt=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v;return t>-r&&n>-r&&n<1+r},Et=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v;return t>-r&&t<1+r&&n>-r&&n<1+r},Nt=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v;return n>r},Gt=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v;return n>r&&n<1-r},Ft=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v;return t>r&&n>r},Tt=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v;return t>r&&n>r&&n<1-r},Lt=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v;return t>r&&t<1-r&&n>r&&n<1-r},Zt=function(t,n,r,e,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:v,u=I(t,r);if(!(Math.abs(u)<o)){var c=-u,a=n[0],s=n[1],f=e[0],l=e[1],h=I([f-a,l-s],r),p=I([a-f,s-l],t),g=h/u,d=p/c;return i(g,d,o)?[a+t[0]*g,s+t[1]*g]:void 0}},Rt=Object.freeze({__proto__:null,include_l:bt,include_r:wt,include_s:At,exclude_l:jt,exclude_r:Ot,exclude_s:Pt,include_l_l:St,include_l_r:kt,include_l_s:zt,include_r_r:It,include_r_s:qt,include_s_s:Et,exclude_l_r:Nt,exclude_l_s:Gt,exclude_r_r:Ft,exclude_r_s:Tt,exclude_s_s:Lt,intersect_lines:Zt}),Dt=function(t,n,r,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:v,o=O(t,r),u=b(n),c=b(o);if(c<i)return e(c,i);if(u<i)return!1;var a=I(o,n),s=P(o,n)/u;return Math.abs(a)<i&&e(s,i)},Ct=function(t,n,r){var e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v,i=O(t,r);return Math.abs(I(i,n))<e},Jt=Object.freeze({__proto__:null,collinear:Dt,point_on_line:Ct,point_on_ray_inclusive:function(t,n,r){var e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v;return Dt(t,n,r,wt,e)},point_on_ray_exclusive:function(t,n,r){var e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v;return Dt(t,n,r,Ot,e)},point_on_segment_inclusive:function(t,n,r){var e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v;return Dt(t,O(r,n),n,At,e)},point_on_segment_exclusive:function(t,n,r){var e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v;return Dt(t,O(r,n),n,Pt,e)}}),Xt=180/Math.PI,Yt=Math.PI/180,$t=2*Math.PI,Bt=function(t,n){for(;t<0;)t+=$t;for(;n<0;)n+=$t;for(;t>$t;)t-=$t;for(;n>$t;)n-=$t;var r=n-t;return r>=0?r:$t-(t-n)},Ht=function(t,n){var r=t[0]*n[0]+t[1]*n[1],e=t[0]*n[1]-t[1]*n[0],i=Math.atan2(e,r);return i<0&&(i+=$t),i},Ut=function(t,n){var r=w(t),e=w(n);return P(r,e)<-1+v?[-r[1],r[0]]:w(j(r,e))},Vt=function(t,n,r,e){var i=t[0]*r[1]-r[0]*t[1];if(Math.abs(i)<v){var o=[[t[0],t[1]],S(n,e)],u=[o,o];return delete u[t[0]*r[0]+t[1]*r[1]>0?1:0],u}var c=((e[0]-n[0])*r[1]-r[0]*(e[1]-n[1]))/i,a=[n[0]+t[0]*c,n[1]+t[1]*c],s=[Ut(t,r)];return s[1]=F(s[0]),s.map((function(t){return{vector:t,origin:a}}))},Wt=function(t,n,r){var e=Bt(n,r)/t;return Array.from(Array(t-1)).map((function(t,r){return n+e*r}))},Kt=function(t,n,r){var e=n[0]-t[0],i=n[1]-t[1],o=r[0]-t[0],u=r[1]-t[1],c=e*(t[0]+n[0])+i*(t[1]+n[1]),a=o*(t[0]+r[0])+u*(t[1]+r[1]),s=2*(e*(r[1]-n[1])-i*(r[0]-n[0]));if(Math.abs(s)<v){var f=Math.min(t[0],n[0],r[0]),l=Math.min(t[1],n[1],r[1]),h=.5*(Math.max(t[0],n[0],r[0])-f),p=.5*(Math.max(t[1],n[1],r[1])-l);return{origin:[f+h,l+p],radius:Math.sqrt(h*h+p*p)}}var g=[(u*c-i*a)/s,(e*a-o*c)/s],d=g[0]-t[0],_=g[1]-t[1];return{origin:g,radius:Math.sqrt(d*d+_*_)}},Qt=function(t){return.5*t.map((function(t,n,r){var e=r[(n+1)%r.length];return t[0]*e[1]-e[0]*t[1]})).reduce((function(t,n){return t+n}),0)},tn=function(t){var n=1/(6*Qt(t));return t.map((function(t,n,r){var e=r[(n+1)%r.length],i=t[0]*e[1]-e[0]*t[1];return[(t[0]+e[0])*i,(t[1]+e[1])*i]})).reduce((function(t,n){return[t[0]+n[0],t[1]+n[1]]}),[0,0]).map((function(t){return t*n}))},nn=function(t){var n=Array(t[0].length).fill(1/0),e=Array(t[0].length).fill(-1/0);t.forEach((function(t){return t.forEach((function(t,r){t<n[r]&&(n[r]=t),t>e[r]&&(e[r]=t)}))}));var i=e.map((function(t,r){return t-n[r]}));return dt.apply(void 0,r(n).concat(r(i)))},rn=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=$t/t/2,o=n/2/Math.cos(i);return Array.from(Array(Math.floor(t))).map((function(n,r){return $t*(r/t)})).map((function(t){return[r+o*Math.cos(t),e+o*Math.sin(t)]})).map((function(t){return t.map((function(t){return a(t,14)}))}))},en=function(){return console.warn("split polygon not done")},on=function(t,n,r){var e=t.map((function(t,e){return{point:Ct(t,n,r)?t:null,at_index:e}})).filter((function(t){return null!=t.point})),i=t.map((function(t,e,i){return{point:function(t,n,r,e){var i=r,o=[e[0]-r[0],e[1]-r[1]];return Zt(t,n,o,i,Gt)}(n,r,t,i[(e+1)%i.length]),at_index:e}})).filter((function(t){return null!=t.point}));if(2==i.length){var o=i.slice().sort((function(t,n){return t.at_index-n.at_index})),u=t.slice(o[1].at_index+1).concat(t.slice(0,o[0].at_index+1));u.push(o[0].point),u.push(o[1].point);var c=t.slice(o[0].at_index+1,o[1].at_index+1);return c.push(o[1].point),c.push(o[0].point),[u,c]}if(1==i.length&&1==e.length){e[0].type="v",i[0].type="e";var a=e.concat(i).sort((function(t,n){return t.at_index-n.at_index})),s=t.slice(a[1].at_index+1).concat(t.slice(0,a[0].at_index+1));"e"===a[0].type&&s.push(a[0].point),s.push(a[1].point);var f=t.slice(a[0].at_index+1,a[1].at_index+1);return"e"===a[1].type&&f.push(a[1].point),f.push(a[0].point),[s,f]}if(2==e.length){var l=e.slice().sort((function(t,n){return t.at_index-n.at_index}));return[t.slice(l[1].at_index).concat(t.slice(0,l[0].at_index+1)),t.slice(l[0].at_index,l[1].at_index+1)]}return[t.slice()]},un=function(n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v,e=1e4,i=n.slice().sort((function(t,n){return Math.abs(t[1]-n[1])<r?t[0]-n[0]:t[1]-n[1]})),o=[];o.push(i[0]);var u=0,c=0,a=function(){c+=1;var t=o.length-1,n=i.filter((function(n){return!(Math.abs(n[0]-o[t][0])<r&&Math.abs(n[1]-o[t][1])<r)})).map((function(n){for(var r=Math.atan2(o[t][1]-n[1],o[t][0]-n[0]);r<u;)r+=2*Math.PI;return{node:n,angle:r,distance:void 0}})).sort((function(t,n){return t.angle<n.angle?-1:t.angle>n.angle?1:0}));if(0===n.length)return{v:void 0};var e=n[0];if(n=n.filter((function(t){return Math.abs(e.angle-t.angle)<r})).map((function(n){var r=Math.sqrt(Math.pow(o[t][0]-n.node[0],2)+Math.pow(o[t][1]-n.node[1],2));return n.distance=r,n})).sort((function(t,n){return t.distance<n.distance?1:t.distance>n.distance?-1:0})),o.filter((function(t){return t===n[0].node})).length>0)return{v:o};o.push(n[0].node),u=Math.atan2(o[t][1]-n[0].node[1],o[t][0]-n[0].node[0])};do{var s=a();if("object"===t(s))return s.v}while(c<e)},cn=Object.freeze({__proto__:null,R2D:Xt,D2R:Yt,TWO_PI:$t,is_counter_clockwise_between:function(t,n,r){for(;r<n;)r+=$t;for(;t>n;)t-=$t;for(;t<n;)t+=$t;return t<r},clockwise_angle2_radians:function(t,n){for(;t<0;)t+=$t;for(;n<0;)n+=$t;for(;t>$t;)t-=$t;for(;n>$t;)n-=$t;var r=t-n;return r>=0?r:$t-(n-t)},counter_clockwise_angle2_radians:Bt,clockwise_angle2:function(t,n){var r=n[0]*t[0]+n[1]*t[1],e=n[0]*t[1]-n[1]*t[0],i=Math.atan2(e,r);return i<0&&(i+=$t),i},counter_clockwise_angle2:Ht,counter_clockwise_vector_order:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var e=n.map((function(t){return Math.atan2(t[1],t[0])})),i=Array.from(Array(e.length)).map((function(t,n){return n})).sort((function(t,n){return e[t]-e[n]}));return i.slice(i.indexOf(0),i.length).concat(i.slice(0,i.indexOf(0)))},interior_angles:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.map((function(t,n,r){return Ht(t,r[(n+1)%r.length])}))},bisect_vectors:Ut,bisect_lines2:Vt,subsect_radians:Wt,subsect:function(t,n,r){var e=Math.atan2(n[1],n[0]),i=Math.atan2(r[1],r[0]);return Wt(t,e,i).map((function(t){return[Math.cos(t),Math.sin(t)]}))},circumcircle:Kt,signed_area:Qt,centroid:tn,enclosing_rectangle:nn,make_regular_polygon:rn,split_polygon:en,split_convex_polygon:on,convex_hull:un}),an=function(t,n,r){for(var e,i=n.map((function(n,e){return{o:n,i:e,d:r(t,n)}})),o=1/0,u=0;u<i.length;u+=1)i[u].d<o&&(e=u,o=i[u].d);return e},sn=function(t,n,r,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:v,o=Math.pow(t[0],2)+Math.pow(t[1],2),u=[0,1].map((function(t,e){return r[e]-n[e]})),c=[0,1].map((function(n,r){return t[r]*u[r]})).reduce((function(t,n){return t+n}),0),a=c/o,s=e(a,i);return[0,1].map((function(r,e){return n[e]+t[e]*s}))},fn=function(t){return t<-v?0:t>1+v?1:t},ln=function(t,n){var r=t.map((function(t,n,r){return O(r[(n+1)%r.length],t)}));return t.map((function(t,e){return sn(r[e],t,n,fn)})).map((function(t,r){return{point:t,i:r,distance:N(t,n)}})).sort((function(t,n){return t.distance-n.distance})).shift()},hn=function(t,n,r){return j(n,A(w(O(r,n)),t))},vn=Object.freeze({__proto__:null,nearest_point2:function(t,n){var r=an(t,n,E);return void 0===r?void 0:n[r]},nearest_point:function(t,n){var r=an(t,n,N);return void 0===r?void 0:n[r]},nearest_point_on_line:sn,segment_limiter:fn,nearest_point_on_polygon:ln,nearest_point_on_circle:hn,nearest_point_on_ellipse:function(){return!1}}),pn=function(n){switch(n.constructor.name){case"vector":case"matrix":case"segment":case"ray":case"line":case"circle":case"ellipse":case"rect":case"polygon":return n.constructor.name}if("object"===t(n)){if(null!=n.radius)return"circle";if(null!=n.width)return"rect";if(null!=n.x||"number"==typeof n[0])return"vector";if(null!=n[0]&&n[0].length&&("number"==typeof n[0].x||"number"==typeof n[0][0]))return"segment";if(null!=n.vector&&null!=n.origin)return"line"}},gn=function(t){return t>=1?0:t<=-1?Math.PI:Math.acos(t)},dn=function(t,n,r){var e=n[0]-t[0],i=n[1]-t[1],o=e*Math.cos(r)+i*Math.sin(r),u=i*Math.cos(r)-e*Math.sin(r);return[t[0]+o,t[1]+u]},_n=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v,e=t.radius<n.radius?t.radius:n.radius,i=t.radius<n.radius?n.radius:t.radius,o=t.radius<n.radius?t.origin:n.origin,u=t.radius<n.radius?n.origin:t.origin,c=[o[0]-u[0],o[1]-u[1]],a=Math.sqrt(Math.pow(c[0],2)+Math.pow(c[1],2));if(!(a<r)){var s=c.map((function(t,n){return t/a*i+u[n]}));if(Math.abs(i+e-a)<r||Math.abs(i-(e+a))<r)return[s];if(!(a+e<i||i+e<a)){var f=gn((e*e-a*a-i*i)/(-2*a*i)),l=dn(u,s,+f),h=dn(u,s,-f);return[l,h]}}},yn=function(t,n,r,e,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:v,u=Math.pow(r[0],2)+Math.pow(r[1],2),c=Math.sqrt(u),a=0===c?r:r.map((function(t){return t/c})),s=[-a[1],a[0]],f=[e[0]-n[0],e[1]-n[1]],l=f[0]*a[1]-a[0]*f[1];if(!(Math.abs(l)>t+o)){var h=Math.sqrt(Math.pow(t,2)-Math.pow(l,2)),p=function(t,r){return n[r]-s[r]*l+a[r]*t},g=Math.abs(t-Math.abs(l))<o?[h].map((function(t){return[t,t].map(p)})):[-h,h].map((function(t){return[t,t].map(p)})),d=g.map((function(t){return t.map((function(t,n){return t-e[n]}))})).map((function(t){return t[0]*r[0]+r[1]*t[1]})).map((function(t){return t/u}));return g.filter((function(t,n){return i(d[n],o)}))}},mn=function(){return!0},Mn=function(t,n){return t>-n},xn=function(t,n){return t>-n&&t<1+n},bn=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v;return yn(t.radius,t.origin,n.vector,n.origin,mn,r)},wn=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v;return yn(t.radius,t.origin,n.vector,n.origin,Mn,r)},An=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v;return yn(t.radius,t.origin,n.vector,n.origin,xn,r)},jn=Object.freeze({__proto__:null,circle_circle:_n,circle_line:bn,circle_ray:wn,circle_segment:An}),On=function(t,n,r,e,i,o){var u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:v,c=I(t,r),a=-c,s=I(O(e,n),r),f=I(O(n,e),t);if(Math.abs(c)<u)return!1;var l=s/c,h=f/a;return i(l,u)&&o(h,u)},Pn=function(t,n,r,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:v;return On(O(n,t),t,O(e,r),r,At,At,i)},Sn=function(t,n,r,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:v;return On(O(n,t),t,O(e,r),r,Pt,Pt,i)},kn=Object.freeze({__proto__:null,overlap_lines:On,overlap_line_line_inclusive:function(t,n,r,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:v;return On(t,n,r,e,bt,bt,i)},overlap_line_ray_inclusive:function(t,n,r,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:v;return On(t,n,r,e,bt,wt,i)},overlap_line_segment_inclusive:function(t,n,r,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:v;return On(t,n,O(e,r),r,bt,At,i)},overlap_ray_ray_inclusive:function(t,n,r,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:v;return On(t,n,r,e,wt,wt,i)},overlap_ray_segment_inclusive:function(t,n,r,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:v;return On(t,n,O(e,r),r,wt,At,i)},overlap_segment_segment_inclusive:Pn,overlap_line_line_exclusive:function(t,n,r,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:v;return On(t,n,r,e,jt,jt,i)},overlap_line_ray_exclusive:function(t,n,r,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:v;return On(t,n,r,e,jt,Ot,i)},overlap_line_segment_exclusive:function(t,n,r,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:v;return On(t,n,O(e,r),r,jt,Pt,i)},overlap_ray_ray_exclusive:function(t,n,r,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:v;return On(t,n,r,e,Ot,Ot,i)},overlap_ray_segment_exclusive:function(t,n,r,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:v;return On(t,n,O(e,r),r,Ot,Pt,i)},overlap_segment_segment_exclusive:Sn}),zn=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v;return n.map((function(t,n,r){return[t,r[(n+1)%r.length]]})).map((function(n){return I(O(n[1],n[0]),O(t,n[0]))>-r})).map((function(t,n,r){return t===r[0]})).reduce((function(t,n){return t&&n}),!0)},In=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v;return n.map((function(t,n,r){return[t,r[(n+1)%r.length]]})).map((function(n){return I(O(n[1],n[0]),O(t,n[0]))>r})).map((function(t,n,r){return t===r[0]})).reduce((function(t,n){return t&&n}),!0)},qn=function(t,n){for(var r=!1,e=0,i=n.length-1;e<n.length;i=e++)n[e][1]>t[1]!=n[i][1]>t[1]&&t[0]<(n[i][0]-n[e][0])*(t[1]-n[e][1])/(n[i][1]-n[e][1])+n[e][0]&&(r=!r);return r},En=function(t,n,r,e){for(var i=t.map((function(t,n,r){return[t,r[(n+1)%r.length]]})),o=n.map((function(t,n,r){return[t,r[(n+1)%r.length]]})),u=0;u<i.length;u+=1)for(var c=0;c<o.length;c+=1)if(r(i[u][0],i[u][1],o[c][0],o[c][1]))return!0;return!!e(n[0],t)||!!e(t[0],n)},Nn=function(t,n){return En(t,n,Sn,In)},Gn=Object.freeze({__proto__:null,point_in_convex_poly_inclusive:zn,point_in_convex_poly_exclusive:In,point_in_poly:qn,overlap_convex_polygons_inclusive:function(t,n){return En(t,n,Pn,zn)},overlap_convex_polygons_exclusive:Nn,enclose_convex_polygons_inclusive:function(t,n){var r=t.map((function(t){return zn(t,n)})).reduce((function(t,n){return t||n}),!1),e=n.map((function(t){return zn(t,n)})).reduce((function(t,n){return t&&n}),!0);return!r&&e}}),Fn=function(t,n){return Math.abs(t[0]-n[0])<v&&Math.abs(t[1]-n[1])<v},Tn=function(t,n,r,e){return Zt(t,n,O(e,r),r,zt)},Ln=function(t,n,r,e){return Zt(t,n,O(e,r),r,qt)},Zn=function(t,n,r,e){return Zt(t,n,O(e,r),r,Tt)},Rn=function(t,n,r,e){return Zt(O(n,t),t,O(e,r),r,Et)},Dn=function(t,n,r,e){return Zt(O(n,t),t,O(e,r),r,Lt)},Cn=function(t,n,r,e){var i=n.map((function(t,n,r){return[t,r[(n+1)%r.length]]})).map((function(n){return t(r,e,n[0],n[1])})).filter((function(t){return null!=t}));switch(i.length){case 0:return;case 1:return[i];default:for(var o=1;o<i.length;o+=1)if(!Fn(i[0],i[o]))return[i[0],i[o]];return[i[0]]}},Jn=function(t,n,r){return Cn(Tn,t,n,r)},Xn=function(t,n,r){return Cn(Ln,t,n,r)},Yn=function(t,n,r){return Cn(Zn,t,n,r)},$n=function(t,n,r){return Cn(Dn,t,n,r)},Bn=Object.freeze({__proto__:null,convex_poly_line:Jn,convex_poly_ray_inclusive:Xn,convex_poly_ray_exclusive:Yn,convex_poly_segment_inclusive:function(t,n,r){return Cn(Rn,t,n,r)},convex_poly_segment_exclusive:$n}),Hn=function(t,n,r,e){return Zt(t.vector,t.origin,n.vector,n.origin,r,e)},Un=function(t,n){return Jn(t.constructor===Array?t:t.points,n.vector,n.origin)},Vn=function(t,n,r){return r(t.constructor===Array?t:t.points,n.vector,n.origin)},Wn=function(t,n,r){return r(t.constructor===Array?t:t.points,n[0],n[1])},Kn={polygon:{line:Un,ray:function(t,n,r){return Vn(t,n,!1===r?Xn:Yn)},segment:function(t,n,r){return Wn(t,n,!1===r?convex_poly_segment_inclusive:$n)}},circle:{circle:_n,line:bn,ray:wn,segment:An},line:{polygon:function(t,n){return Un(n,t)},circle:function(t,n){return bn(n,t)},line:function(t,n){return Hn(t,n,St)},ray:function(t,n,r){return Hn(t,n,!1===r?Nt:kt)},segment:function(t,n,r){return Hn(t,n,!1===r?Gt:zt)}},ray:{polygon:function(t,n,r){return Vn(n,t,!1===r?Xn:Yn)},circle:function(t,n){return wn(n,t)},line:function(t,n,r){return Hn(n,t,!1===r?Nt:kt)},ray:function(t,n,r){return Hn(t,n,!1===r?Ft:It)},segment:function(t,n,r){return Hn(t,n,!1===r?Tt:qt)}},segment:{polygon:function(t,n,r){return Wn(n,t,!1===r?convex_poly_segment_inclusive:$n)},circle:function(t,n){return An(n,t)},line:function(t,n,r){return Hn(n,t,!1===r?Gt:zt)},ray:function(t,n,r){return Hn(n,t,!1===r?Tt:qt)},segment:function(t,n,r){return Hn(t,n,!1===r?Lt:Et)}}},Qn=function(t,n){var r,e=pn(t),i=pn(n);return(r=Kn[e])[i].apply(r,arguments)},tr=Object.assign(Object.create(null),kn,Jt,Gn),nr=function(t,n,r,e){return n.map((function(t,n,r){return[t,r[(n+1)%r.length]]})).map((function(n){return t(r,e,n[0],n[1])})).filter((function(t){return null!=t}))},rr=function(t){for(var n=1;n<t.length;n+=1)if(!Fn(t[0],t[n]))return[t[0],t[n]]},er=function(t,n,r){if(0!==t.length){zn(r,n);return rr(t)||[r,t[0]]}},ir=function(t,n,e,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:v,u=In(e,n,o),c=In(i,n,o),a=zn(e,n,o),s=zn(i,n,o);switch(t.length){case 0:return u||c||a&&s?[r(e),r(i)]:void 0;case 1:return a?[r(e),t[0]]:[r(i),t[0]];default:var f=rr(t);return void 0!==f?f:a?[r(e),t[0]]:[r(i),t[0]]}},or=function(t,n,r){return function(t){switch(t.length){case 0:case 1:return;default:return rr(t)}}(nr(Tn,t,n,r))},ur=function(t,n,r){var e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v,i=zn(r,t,e)?Ln:Zn,o=nr(i,t,n,r);return er(o,t,r)},cr=function(t,n,r){var e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v,i=zn(n,t,e)||zn(r,t,e)?Rn:Dn,o=nr(i,t,n,r);return ir(o,t,n,r)},ar=Object.freeze({__proto__:null,clip_line_in_convex_poly:or,clip_ray_in_convex_poly_exclusive:ur,clip_ray_in_convex_poly_inclusive:function(t,n,r){var e=nr(Ln,t,n,r);return er(e,t,r)},clip_segment_in_convex_poly_exclusive:cr,clip_segment_in_convex_poly_inclusive:function(t,n,r){var e=nr(Rn,t,n,r);return ir(e,t,n,r)}}),sr={preserve:{magnitude:function(){return x(this)},isEquivalent:function(){return _(this,ht(arguments))},isParallel:function(){return Z.apply(void 0,r(u(this,ht(arguments))))},dot:function(){return P.apply(void 0,r(u(this,ht(arguments))))},distanceTo:function(){return N.apply(void 0,r(u(this,ht(arguments))))}},vector:{copy:function(){return r(this)},normalize:function(){return w(this)},scale:function(){return A(this,arguments[0])},flip:function(){return G(this)},rotate90:function(){return F(this)},rotate270:function(){return T(this)},cross:function(){return q(o(3,this),o(3,ht(arguments)))},transform:function(){return W(Mt(arguments),o(3,this))},add:function(){return j(this,o(this.length,ht(arguments)))},subtract:function(){return O(this,o(this.length,ht(arguments)))},rotateZ:function(t,n){return W(Mt(Y(t,n)),o(3,this))},lerp:function(t,n){return z(this,o(this.length,ht(t)),n)},midpoint:function(){return S.apply(void 0,r(u(this,ht(arguments))))},bisect:function(){return Ut(this,ht(arguments))}}},fr={};Object.keys(sr.preserve).forEach((function(t){fr[t]=sr.preserve[t]})),Object.keys(sr.vector).forEach((function(t){fr[t]=function(){return D.vector.apply(D,r(sr.vector[t].apply(this,arguments)))}}));var lr={fromAngle:function(t){return D.vector(Math.cos(t),Math.sin(t))},fromAngleDegrees:function(t){return D.vector.fromAngle(t*Yt)}},hr={vector:{P:Array.prototype,A:function(){var t=this;ht(arguments).forEach((function(n){return t.push(n)}))},G:{x:function(){return this[0]},y:function(){return this[1]},z:function(){return this[2]}},M:fr,S:lr}},vr={};vr.prototype=Object.create(Object.prototype),vr.prototype.constructor=vr,vr.prototype.isParallel=function(){var t=u(this.vector,gt.apply(void 0,arguments).vector);return Z.apply(void 0,r(t))},vr.prototype.isDegenerate=function(){return L(this.vector)},vr.prototype.reflection=function(){return D.matrix($(this.vector,this.origin))},vr.prototype.nearestPoint=function(){var t=ht(arguments);return D.vector(sn(this.vector,this.origin,t,this.clip_function))},vr.prototype.transform=function(){var t=this.dimension,n=K(Mt(arguments),o(3,this.vector),o(3,this.origin));return this.constructor(o(t,n.vector),o(t,n.origin))},vr.prototype.intersect=function(t){return Qn(this,t)},vr.prototype.bisect=function(){var t=gt(arguments);return Vt(this.vector,this.origin,t.vector,t.origin)},Object.defineProperty(vr.prototype,"dimension",{get:function(){return[this.vector,this.origin].map((function(t){return t.length})).reduce((function(t,n){return Math.max(t,n)}),0)}});var pr={fromPoints:function(){var t=vt(arguments);return this.constructor({vector:O(t[1],t[0]),origin:t[0]})},perpendicularBisector:function(){var t=vt(arguments);return this.constructor({vector:F(O(t[1],t[0])),origin:k(t[0],t[1])})}},gr={line:{P:vr.prototype,A:function(){var t=gt.apply(void 0,arguments);this.vector=D.vector(t.vector),this.origin=D.vector(o(this.vector.length,t.origin))},G:{length:function(){return 1/0}},M:{clip_function:function(t){return t},svgPath:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e4,n=this.origin.add(this.vector.scale(-t/2)),r=this.vector.scale(t);return"M".concat(n[0]," ").concat(n[1],"l").concat(r[0]," ").concat(r[1])}},S:pr}},dr={ray:{P:vr.prototype,A:function(){var t=gt.apply(void 0,arguments);this.vector=D.vector(t.vector),this.origin=D.vector(o(this.vector.length,t.origin))},G:{length:function(){return 1/0}},M:{rotate180:function(){return D.ray(G(this.vector),this.origin)},clip_function:function(t){return t<-v?0:t},svgPath:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4,n=this.vector.scale(t);return"M".concat(this.origin[0]," ").concat(this.origin[1],"l").concat(n[0]," ").concat(n[1])}},S:pr}},_r={segment:{P:vr.prototype,A:function(){var t=pt.apply(void 0,arguments);this.points=[D.vector(t[0]),D.vector(t[1])],this.vector=this.points[1].subtract(this.points[0]),this.origin=this.points[0]},G:{0:function(){return this.points[0]},1:function(){return this.points[1]},length:function(){return this.vector.magnitude()}},M:{clip_function:fn,transform:function(){for(var t=this.points[0].length,n=arguments.length,r=new Array(n),e=0;e<n;e++)r[e]=arguments[e];var i=Mt(r),u=this.points.map((function(t){return o(3,t)})).map((function(t){return W(i,t)})).map((function(n){return o(t,n)}));return D.segment(u)},midpoint:function(){return D.vector(k(this.points[0],this.points[1]))},svgPath:function(){var t=this.points.map((function(t){return"".concat(t[0]," ").concat(t[1])}));return["M","L"].map((function(n,r){return"".concat(n).concat(t[r])})).join("")}},S:{fromPoints:function(){return this.constructor.apply(this,arguments)}}}},yr=function(t,n,r,e,i,o){var u=Math.cos(i),c=Math.sin(i),a=Math.cos(o),s=Math.sin(o);return[t+u*r*a+-c*e*s,n+c*r*a+u*e*s]},mr=function(t,n,r,e,i,o,u){var c=o;if(c<0&&!isNaN(c))for(;c<0;)c+=2*Math.PI;var a=u>2*Math.PI?2*Math.PI:u,s=yr(t,n,r,e,i,c),f=yr(t,n,r,e,i,c+a/2),l=yr(t,n,r,e,i,c+a),h=a/2>Math.PI?1:0,v=a/2>0?1:0;return{x1:s[0],y1:s[1],x2:f[0],y2:f[1],x3:l[0],y3:l[1],fa:h,fs:v}},Mr=function(t){return a(t,4)},xr=function(t,n,r,e,i,o,u){return"A".concat(Mr(t)," ").concat(Mr(n)," ").concat(Mr(r)," ").concat(Mr(e)," ").concat(Mr(i)," ").concat(Mr(o)," ").concat(Mr(u))},br={circle:{A:function(){var t=vt(arguments),n=l(arguments).filter((function(t){return"number"==typeof t}));if(2===arguments.length)1===t[1].length?(this.radius=t[1][0],this.origin=D.vector.apply(D,r(t[0]))):1===t[0].length?(this.radius=t[0][0],this.origin=D.vector.apply(D,r(t[1]))):t[0].length>1&&t[1].length>1&&(this.radius=E.apply(void 0,r(t)),this.origin=D.vector.apply(D,r(t[0])));else switch(n.length){case 0:this.radius=1,this.origin=D.vector(0,0,0);break;case 1:this.radius=n[0],this.origin=D.vector(0,0,0);break;default:this.radius=n.pop(),this.origin=D.vector.apply(D,r(n))}},G:{x:function(){return this.origin[0]},y:function(){return this.origin[1]},z:function(){return this.origin[2]}},M:{nearestPoint:function(){return D.vector(hn(this.radius,this.origin,ht(arguments)))},intersect:function(t){return Qn(this,t)},svgPath:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2*Math.PI,r=mr(this.origin[0],this.origin[1],this.radius,this.radius,0,t,n),e=xr(this.radius,this.radius,0,r.fa,r.fs,r.x2,r.y2),i=xr(this.radius,this.radius,0,r.fa,r.fs,r.x3,r.y3);return"M".concat(r.x1," ").concat(r.y1).concat(e).concat(i)},points:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128;return Array.from(Array(n)).map((function(t,r){return 2*Math.PI/n*r})).map((function(n){return[t.origin[0]+t.radius*Math.cos(n),t.origin[1]+t.radius*Math.sin(n)]}))},polygon:function(){return D.polygon(this.points(arguments[0]))},segments:function(){var t=this.points(arguments[0]);return t.map((function(n,r){var e=(r+1)%t.length;return[n,t[e]]}))}},S:{fromPoints:function(){if(3===arguments.length){var t=Kt.apply(void 0,arguments);return this.constructor(t.radius,t.origin)}return this.constructor.apply(this,arguments)},fromThreePoints:function(){var t=Kt.apply(void 0,arguments);return this.constructor(t.radius,t.origin)}}}},wr=function(t,n,r,e){var i=n>r,o=i?Math.pow(n,2)-Math.pow(r,2):Math.pow(r,2)-Math.pow(n,2),u=Math.sqrt(o),c=i?Math.cos(e):Math.sin(e),a=i?Math.sin(e):Math.cos(e);return[D.vector(t[0]+u*c,t[1]+u*a),D.vector(t[0]-u*c,t[1]-u*a)]},Ar={ellipse:{A:function(){var t=l(arguments).filter((function(t){return!isNaN(t)})),n=o(5,t);this.rx=n[0],this.ry=n[1],this.origin=D.vector(n[2],n[3]),this.spin=n[4],this.foci=wr(this.origin,this.rx,this.ry,this.spin)},G:{x:function(){return this.origin[0]},y:function(){return this.origin[1]}},M:{svgPath:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2*Math.PI,r=mr(this.origin[0],this.origin[1],this.rx,this.ry,this.spin,t,n),e=xr(this.rx,this.ry,this.spin/Math.PI*180,r.fa,r.fs,r.x2,r.y2),i=xr(this.rx,this.ry,this.spin/Math.PI*180,r.fa,r.fs,r.x3,r.y3);return"M".concat(r.x1," ").concat(r.y1).concat(e).concat(i)},points:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128;return Array.from(Array(n)).map((function(t,r){return 2*Math.PI/n*r})).map((function(n){return yr(t.origin.x,t.origin.y,t.rx,t.ry,t.spin,n)}))},polygon:function(){return D.polygon(this.points(arguments[0]))},segments:function(){var t=this.points(arguments[0]);return t.map((function(n,r){var e=(r+1)%t.length;return[n,t[e]]}))}},S:{}}},jr=function(t){return void 0===t?void 0:D.segment(t)},Or={area:function(){return Qt(this)},centroid:function(){return D.vector(tn(this))},enclosingRectangle:function(){return D.rect(nn(this))},contains:function(){return qn(ht(arguments),this)},scale:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tn(this),r=this.map((function(t){return[0,1].map((function(r,e){return t[e]-n[e]}))})).map((function(r){return r.map((function(e,i){return n[i]+r[i]*t}))}));return this.constructor.fromPoints(r)},rotate:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tn(this),r=this.map((function(r){var e=[r[0]-n[0],r[1]-n[1]],i=Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)),o=Math.atan2(e[1],e[0]);return[n[0]+Math.cos(o+t)*i,n[1]+Math.sin(o+t)*i]}));return D.polygon(r)},translate:function(){var t=ht.apply(void 0,arguments),n=this.map((function(n){return n.map((function(n,r){return n+t[r]}))}));return this.constructor.fromPoints(n)},transform:function(){var t=Mt.apply(void 0,arguments),n=this.map((function(n){return W(t,o(3,n))}));return D.polygon(n)},nearest:function(){var t=ht.apply(void 0,arguments),n=ln(this,t);return void 0===n?void 0:Object.assign(n,{edge:this.sides[n.i]})},overlaps:function(){var t=f(arguments);return Nn(this,t)},split:function(){var t=gt.apply(void 0,arguments),n=this.isConvex?on:en;return n(this,t.vector,t.origin).map((function(t){return D.polygon(t)}))},intersectLine:function(){var t=gt.apply(void 0,arguments);return Jn(this,t.vector,t.origin)},intersectRay:function(){var t=gt.apply(void 0,arguments);return Yn(this,t.vector,t.origin)},intersectSegment:function(){var t=pt.apply(void 0,arguments);return $n(this,t[0],t[1])},clipLine:function(){var t=gt.apply(void 0,arguments),n=or(this,t.vector,t.origin);return jr(n)},clipRay:function(){var t=gt.apply(void 0,arguments),n=ur(this,t.vector,t.origin);return jr(n)},clipSegment:function(){var t=pt.apply(void 0,arguments),n=cr(this,t[0],t[1]);return jr(n)},svgPath:function(){var t=Array(this.length).fill("L");return t[0]="M","".concat(this.map((function(n,r){return"".concat(t[r]).concat(n[0]," ").concat(n[1])})).join(""),"z")},intersect:function(t){return Qn(this,t)}},Pr={};Pr.prototype=Object.create(Array.prototype),Pr.prototype.constructor=Pr,Object.keys(Or).forEach((function(t){Pr.prototype[t]=Or[t]}));var Sr=function(t){return[[t.x,t.y],[t.x+t.width,t.y],[t.x+t.width,t.y+t.height],[t.x,t.y+t.height]]},kr={rect:{P:Pr.prototype,A:function(){var t=_t.apply(void 0,arguments);this.width=t.width,this.height=t.height,this.origin=D.vector(t.x,t.y),this.push.apply(this,r(Sr(this)))},G:{x:function(){return this.origin[0]},y:function(){return this.origin[1]}},M:{area:function(){return this.width*this.height},segments:function(){return[[[(t=this).x,t.y],[t.x+t.width,t.y]],[[t.x+t.width,t.y],[t.x+t.width,t.y+t.height]],[[t.x+t.width,t.y+t.height],[t.x,t.y+t.height]],[[t.x,t.y+t.height],[t.x,t.y]]];var t},svgPath:function(){return"M".concat(this.origin.join(" "),"h").concat(this.width,"v").concat(this.height,"h").concat(-this.width,"Z")}},S:{fromPoints:function(){return D.rect(nn(vt(arguments)))}}}},zr={polygon:{P:Pr.prototype,A:function(){this.push.apply(this,r(f(arguments))),this.sides=this.map((function(t,n,r){return[t,r[(n+1)%r.length]]})),this.vectors=this.sides.map((function(t){return O(t[1],t[0])}))},G:{isConvex:function(){return!0},points:function(){return this},edges:function(){return this.sides}},M:{segments:function(){return this.sides}},S:{fromPoints:function(){return this.constructor.apply(this,arguments)},regularPolygon:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.constructor(rn(t,n,r,e))},convexHull:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.constructor(un(t,n))}}}},Ir=function(t,n){for(var r=0;r<12;r+=1)t[r]=n[r];return t},qr={matrix:{P:Array.prototype,A:function(){var t=this;Mt(arguments).forEach((function(n){return t.push(n)}))},G:{},M:{copy:function(){return D.matrix.apply(D,r(Array.from(this)))},set:function(){return Ir(this,Mt(arguments))},isIdentity:function(){return V(this)},multiply:function(t){return Ir(this,Q(this,t))},determinant:function(){return tt(this)},inverse:function(){return Ir(this,nt(this))},translate:function(t,n,r){return Ir(this,Q(this,rt(t,n,r)))},rotateX:function(t){return Ir(this,Q(this,it(t)))},rotateY:function(t){return Ir(this,Q(this,ot(t)))},rotateZ:function(t){return Ir(this,Q(this,ut(t)))},rotate:function(t,n,r){var e=ct(t,n,r);return Ir(this,Q(this,e))},scale:function(t){return Ir(this,Q(this,at(t)))},reflectZ:function(t,n){var r=st(t,n);return Ir(this,Q(this,r))},transform:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return D.vector(W(ht(n),this))},transformVector:function(t){return D.vector(W(this,t))},transformLine:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var e=gt(n);return D.line(K(this,e.vector,e.origin))}},S:{}}},Er=Object.assign({},hr,gr,dr,_r,br,Ar,kr,zr,qr),Nr=function(t,n){var r=Object.create(Er[t].proto);return Er[t].A.apply(r,n),r};Object.assign(D,{vector:function(){return Nr("vector",arguments)},circle:function(){return Nr("circle",arguments)},ellipse:function(){return Nr("ellipse",arguments)},rect:function(){return Nr("rect",arguments)},polygon:function(){return Nr("polygon",arguments)},line:function(){return Nr("line",arguments)},ray:function(){return Nr("ray",arguments)},segment:function(){return Nr("segment",arguments)},matrix:function(){return Nr("matrix",arguments)}}),Object.keys(Er).forEach((function(t){var n={};n.prototype=null!=Er[t].P?Object.create(Er[t].P):Object.create(Object.prototype),n.prototype.constructor=n,D[t].prototype=n.prototype,D[t].prototype.constructor=D[t],Object.keys(Er[t].G).forEach((function(r){return Object.defineProperty(n.prototype,r,{get:Er[t].G[r]})})),Object.keys(Er[t].M).forEach((function(r){return Object.defineProperty(n.prototype,r,{value:Er[t].M[r]})})),Object.keys(Er[t].S).forEach((function(n){return Object.defineProperty(D[t],n,{value:Er[t].S[n].bind(D[t].prototype)})})),Er[t].proto=n.prototype}));var Gr=D;return Gr.core=Object.assign(Object.create(null),R,y,cn,B,ft,vn,tr,xt,h,jn,Rt,Bn,ar),Gr.typeof=pn,Gr.intersect=Qn,Gr}));
