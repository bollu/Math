!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t=t||self).math=n()}(this,(function(){"use strict";var t=function(t){return Math.sqrt(t.map((function(t){return t*t})).reduce((function(t,n){return t+n}),0))},n=function(n){var r=t(n);return 0===r?n:n.map((function(t){return t/r}))},r=function(t,n){return t.map((function(r,e){return t[e]*n[e]})).reduce((function(t,n){return t+n}),0)},e=function(){var t=arguments,n=arguments.length>0?arguments[0].length:0,r=Array(n).fill(0);return Array.from(arguments).forEach((function(t){return r.forEach((function(n,e){r[e]+=t[e]||0}))})),r.map((function(n){return n/t.length}))},i=function(t,n){return[t[1]*n[2]-t[2]*n[1],t[0]*n[2]-t[2]*n[0],t[0]*n[1]-t[1]*n[0]]},o=function(t,n){var r=t[0]-n[0],e=t[1]-n[1];return Math.sqrt(r*r+e*e)},u=function(t,n){return Math.sqrt(Array.from(Array(t.length)).map((function(r,e){return Math.pow(t[e]-n[e],2)})).reduce((function(t,n){return t+n}),0))},c=function(t,n,r,e){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:EPSILON,o=Math.pow(n[0],2)+Math.pow(n[1],2),u=[0,1].map((function(n,e){return r[e]-t[e]})),c=[0,1].map((function(t,r){return n[r]*u[r]})).reduce((function(t,n){return t+n}),0),a=c/o,f=e(a,i);return[0,1].map((function(r,e){return t[e]+n[e]*f}))},a={};function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,n){if(!t)return;if("string"==typeof t)return p(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return p(t,n)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}var h=function(t){if("object"===f(t)){if(null!=t.radius)return"circle";if(null!=t.width)return"rectangle";if(null!=t.x)return"vector";if(null!=t.rotate180)return"ray";if(null!=t[0]&&t[0].length&&null!=t[0].x)return"segment";if(null!=t.vector&&null!=t.origin)return"line"}},l=function(t,n){return Array(t).fill(0).map((function(t,r){return n[r]?n[r]:t}))},v=function(t,n){var r=t.length>n.length?t.length:n.length;return[t,n].map((function(t){return l(r,t)}))},g=function(t){return null!=t&&"function"==typeof t[Symbol.iterator]},m=function t(){switch(arguments.length){case void 0:case 0:return Array.from(arguments);case 1:return g(arguments[0])&&"string"!=typeof arguments[0]?t.apply(void 0,s(arguments[0])):[arguments[0]];default:return Array.from(arguments).map((function(n){return g(n)?s(t(n)):n}))}},y=function(){var t=m(arguments);return t.length>1?t.reduce((function(t,n){return t.concat(n)}),[]):t},d=function(){if(arguments[0]instanceof a.vector)return arguments[0];var t=y(arguments);return t.length>0&&"object"===f(t[0])&&null!==t[0]&&!isNaN(t[0].x)&&(t=["x","y","z"].map((function(n){return t[0][n]})).filter((function(t){return void 0!==t}))),t.filter((function(t){return"number"==typeof t}))},M=function(){return m(arguments).map((function(t){return d(t)}))},b=[1,0,0,1,0,0],w=function(){var t=d(arguments);if(void 0!==t)return 6===t.length?t:t.length>6?[t[0],t[1],t[2],t[3],t[4],t[5]]:t.length<6?b.map((function(n,r){return t[r]||n})):void 0};function A(){return arguments[0]instanceof a.segment?arguments[0]:4===arguments.length?[[arguments[0],arguments[1]],[arguments[2],arguments[3]]]:M(arguments)}function j(){if(arguments[0]instanceof a.line)return arguments[0];if(4===arguments.length)return{origin:[arguments[0],arguments[1]],vector:[arguments[2],arguments[3]]};var t=Array.from(arguments),n=t.filter((function(t){return!isNaN(t)})),r=t.filter((function(t){return t.constructor===Array}));if(0===t.length)return{vector:[],origin:[]};if(!isNaN(t[0])&&n.length>=4)return{origin:[t[0],t[1]],vector:[t[2],t[3]]};if(r.length>0){if(1===r.length)return j.apply(void 0,s(r[0]));if(2===r.length)return{origin:[r[0][0],r[0][1]],vector:[r[1][0],r[1][1]]};if(4===r.length)return{origin:[r[0],r[1]],vector:[r[2],r[3]]}}if(t[0].constructor===Object){var e=[],i=[];return null!=t[0].vector?e=d(t[0].vector):null!=t[0].direction&&(e=d(t[0].direction)),null!=t[0].origin?i=d(t[0].origin):null!=t[0].point&&(i=d(t[0].point)),{origin:i,vector:e}}return{origin:[],vector:[]}}var O=function(t,e){return 1-Math.abs(r(n(t),n(e)))<1e-6},S=function(t,n){for(var r=!1,e=0,i=n.length-1;e<n.length;i=e++)n[e][1]>t[1]!=n[i][1]>t[1]&&t[0]<(n[i][0]-n[e][0])*(t[1]-n[e][1])/(n[i][1]-n[e][1])+n[e][0]&&(r=!r);return r},P=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-6;return null!=n&&n.length>0&&n.map((function(n,e,i){var o=i[(e+1)%i.length],u=[o[0]-n[0],o[1]-n[1]],c=[t[0]-n[0],t[1]-n[1]];return u[0]*c[1]-u[1]*c[0]>-r})).map((function(t,n,r){return t===r[0]})).reduce((function(t,n){return t&&n}),!0)},E=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-6;return null!=n&&n.length>0&&n.map((function(n,e,i){var o=i[(e+1)%i.length],u=[o[0]-n[0],o[1]-n[1]],c=[t[0]-n[0],t[1]-n[1]];return u[0]*c[1]-u[1]*c[0]>r})).map((function(t,n,r){return t===r[0]})).reduce((function(t,n){return t&&n}),!0)},x=function(){return!0},q=function(t,n){return n>=-1e-6},_=function(t,n){return n>=-1e-6&&n<=1.000001},N=function(t,n){return t>=-1e-6&&n>=-1e-6},G=function(t,n){return t>=-1e-6&&n>=-1e-6&&n<=1.000001},I=function(t,n){return t>=-1e-6&&t<=1.000001&&n>=-1e-6&&n<=1.000001},k=function(t,n){return n>1e-6},z=function(t,n){return n>1e-6&&n<.999999},L=function(t,n){return t>1e-6&&n>1e-6},C=function(t,n){return t>1e-6&&n>1e-6&&n<.999999},R=function(t,n){return t>1e-6&&t<.999999&&n>1e-6&&n<.999999},Z=function(t,n){return t[0]*n[1]-n[0]*t[1]},T=function(t,n,r){var e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-6,i=Z(t.vector,n.vector);if(!(Math.abs(i)<e)){var o=-i,u=Z([n.origin[0]-t.origin[0],n.origin[1]-t.origin[1]],n.vector),c=Z([t.origin[0]-n.origin[0],t.origin[1]-n.origin[1]],t.vector),a=u/i,f=c/o;return r(a,f,e)?[t.origin[0]+t.vector[0]*a,t.origin[1]+t.vector[1]*a]:void 0}},B=function(t,r){var e=n(t),i=n(r),o=e.map((function(t,n){return e[n]+i[n]})),u=n(o),c=e.map((function(t,n){return-e[n]-i[n]}));return[u,n(c)]},D=function(t){return.5*t.map((function(t,n,r){var e=r[(n+1)%r.length];return t[0]*e[1]-e[0]*t[1]})).reduce((function(t,n){return t+n}),0)},U=function(t){var n=1/(6*D(t));return t.map((function(t,n,r){var e=r[(n+1)%r.length],i=t[0]*e[1]-e[0]*t[1];return[(t[0]+e[0])*i,(t[1]+e[1])*i]})).reduce((function(t,n){return[t[0]+n[0],t[1]+n[1]]}),[0,0]).map((function(t){return t*n}))},V=function(t){var n=Array(t[0].length).fill(1/0),r=Array(t[0].length).fill(-1/0);t.forEach((function(t){return t.forEach((function(t,e){t<n[e]&&(n[e]=t),t>r[e]&&(r[e]=t)}))}));var e=r.map((function(t,r){return t-n[r]}));return[n,e]},$=function(t,n,r){var e=t.map((function(t,e){return{type:"v",point:function(t,n,r){var e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-6,i=[r[0]-t[0],r[1]-t[1]],o=i[0]*n[1]-i[1]*n[0];return Math.abs(o)<e}(n,r,t)?t:null,at_index:e}})).filter((function(t){return null!=t.point})),i=t.map((function(t,e,i){return{type:"e",point:function(t,n,r,e){var i=r,o=[e[0]-r[0],e[1]-r[1]];return T(t,n,i,o,z)}(n,r,t,i[(e+1)%i.length]),at_index:e}})).filter((function(t){return null!=t.point})),o=e.concat(i).sort((function(t,n){return Math.abs(t.point[0]-n.point[0])<1e-6?t.point[1]-n.point[1]:t.point[0]-n.point[0]}));return console.log(o),t},F=function(t,n){return[t[0]*n[0]+t[2]*n[1]+t[4],t[1]*n[0]+t[3]*n[1]+t[5]]},H=function(t,n,r){return{origin:[t[0]*n[0]+t[2]*n[1]+t[4],t[1]*n[0]+t[3]*n[1]+t[5]],vector:[t[0]*r[0]+t[2]*r[1],t[1]*r[0]+t[3]*r[1]]}},J={preserve:{magnitude:function(){return t(this)},isEquivalent:function(){var t=v(this,d(arguments));return t[0].map((function(n,r){return Math.abs(t[0][r]-t[1][r])<1e-6})).reduce((function(t,n){return t&&n}),!0)},isParallel:function(){return O.apply(void 0,s(v(this,d(arguments))))},dot:function(){return r.apply(void 0,s(v(this,d(arguments))))},distanceTo:function(){var t=v(this,d(arguments));return Math.sqrt(t.map((function(n,r){return Math.pow(t[0][r]-t[1][r],2)})).reduce((function(t,n){return t+n}),0))},bisect:function(){return B(this,d(arguments)).map((function(t){return a.vector(t)}))}},vector:{copy:function(){return s(this)},normalize:function(){return n(this)},scale:function(t){return this.map((function(n){return n*t}))},cross:function(){return i(l(3,this),l(3,d(arguments)))},add:function(){var t=this;return l(this.length,d(arguments)).map((function(n,r){return t[r]+n}))},subtract:function(){var t=this;return l(this.length,d(arguments)).map((function(n,r){return t[r]-n}))},rotateZ90:function(){return[-this[1],this[0]]},rotateZ180:function(){return[-this[0],-this[1]]},rotateZ270:function(){return[this[1],-this[0]]},flip:function(){return this.map((function(t){return-t}))},lerp:function(t,n){var r=this,e=1-n;return l(this.length,d(t)).map((function(t,i){return r[i]*e+t*n}))},midpoint:function(){var t=v(this,d(arguments));return t[0].map((function(n,r){return(t[0][r]+t[1][r])/2}))}}},K={};Object.keys(J.preserve).forEach((function(t){K[t]=J.preserve[t]})),Object.keys(J.vector).forEach((function(t){K[t]=function(){return a.vector.apply(a,s(J.vector[t].apply(this,arguments)))}}));var Q={fromAngle:function(t){return a.vector(Math.cos(t),Math.sin(t))}},W={vector:{P:Array.prototype,A:function(){var t=this;d(arguments).forEach((function(n){return t.push(n)}))},G:{x:function(){return this[0]},y:function(){return this[1]},z:function(){return this[2]}},M:K,S:Q}},X=function(t){return t>=1?0:t<=-1?Math.PI:Math.acos(t)},Y=function(t,n,r){var e=n[0]-t[0],i=n[1]-t[1],o=e*Math.cos(r)+i*Math.sin(r),u=i*Math.cos(r)-e*Math.sin(r);return[t[0]+o,t[1]+u]},tt=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-6,e=Math.pow(n.vector[0],2)+Math.pow(n.vector[1],2),i=Math.sqrt(e),o=0===i?n.vector:n.vector.map((function(t){return t/i})),u=[-o[1],o[0]],c=[n.origin[0]-t.origin[0],n.origin[1]-t.origin[1]],a=c[0]*o[1]-o[0]*c[1];if(!(Math.abs(a)>t.radius+r)){var f=Math.sqrt(Math.pow(t.radius,2)-Math.pow(a,2)),s=function(n,r){return t.origin[r]-u[r]*a+o[r]*n};return Math.abs(t.radius-Math.abs(a))<r?[f].map((function(t){return[t,t].map(s)})):[-f,f].map((function(t){return[t,t].map(s)}))}},nt=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-6,e=Math.pow(n.vector[0],2)+Math.pow(n.vector[1],2),i=Math.sqrt(e),o=0===i?n.vector:n.vector.map((function(t){return t/i})),u=[-o[1],o[0]],c=[n.origin[0]-t.origin[0],n.origin[1]-t.origin[1]],a=c[0]*o[1]-o[0]*c[1];if(!(Math.abs(a)>t.radius+r)){var f=Math.sqrt(Math.pow(t.radius,2)-Math.pow(a,2)),s=function(n,r){return t.origin[r]-u[r]*a+o[r]*n},p=Math.abs(t.radius-Math.abs(a))<r?[f].map((function(t){return[t,t].map(s)})):[-f,f].map((function(t){return[t,t].map(s)})),h=p.map((function(t){return t.map((function(t,r){return t-n.origin[r]}))})).map((function(t){return t[0]*n.vector[0]+n.vector[1]*t[1]})).map((function(t){return t/e}));return p.filter((function(t,n){return h[n]>-r}))}},rt=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-6,e=Math.pow(n.vector[0],2)+Math.pow(n.vector[1],2),i=Math.sqrt(e),o=0===i?n.vector:n.vector.map((function(t){return t/i})),u=[-o[1],o[0]],c=[n.origin[0]-t.origin[0],n.origin[1]-t.origin[1]],a=c[0]*o[1]-o[0]*c[1];if(!(Math.abs(a)>t.radius+r)){var f=Math.sqrt(Math.pow(t.radius,2)-Math.pow(a,2)),s=function(n,r){return t.origin[r]-u[r]*a+o[r]*n},p=Math.abs(t.radius-Math.abs(a))<r?[f].map((function(t){return[t,t].map(s)})):[-f,f].map((function(t){return[t,t].map(s)})),h=p.map((function(t){return t.map((function(t,r){return t-n.origin[r]}))})).map((function(t){return t[0]*n.vector[0]+n.vector[1]*t[1]})).map((function(t){return t/e}));return p.filter((function(t,n){return h[n]>-r&&h[n]<1+r}))}},et=function(t,n){return Math.abs(t[0]-n[0])<1e-6&&Math.abs(t[1]-n[1])<1e-6},it=function(t,n,r){var e=t.map((function(t,n,r){return[t,r[(n+1)%r.length]]})).map((function(t){return function(t,n,r,e){var i={origin:t,vector:n},o={origin:r,vector:[[e[0]-r[0]],[e[1]-r[1]]]};return T(i,o,_)}(n,r,t[0],t[1])})).filter((function(t){return null!=t}));switch(e.length){case 0:return;case 1:return[e[0],e[0]];case 2:return e;default:for(var i=1;i<e.length;i+=1)if(!et(e[0],e[i]))return[e[0],e[i]];return}},ot=function(t,n,r){var e=t.map((function(t,n,r){return[t,r[(n+1)%r.length]]})).map((function(t){return ray_segment(n,r,t[0],t[1])})).filter((function(t){return null!=t}));switch(e.length){case 0:return;case 1:return[n,e[0]];case 2:return e;default:for(var i=1;i<e.length;i+=1)if(!et(e[0],e[i]))return[e[0],e[i]];return}},ut=function(t,n,r){var e=t.map((function(t,n,r){return[t,r[(n+1)%r.length]]})).map((function(t){return segment_segment_exclusive(n,r,t[0],t[1])})).filter((function(t){return null!=t})),i=E(n,t),o=E(r,t),u=P(n,t),c=P(r,t);if(0===e.length&&(i||o))return[n,r];if(0===e.length&&u&&c)return[n,r];switch(e.length){case 0:return i?[s(n),s(r)]:void 0;case 1:return u?[s(n),e[0]]:[s(r),e[0]];case 2:return e;default:throw new Error("clipping segment in a convex polygon resulting in 3 or more points")}},ct={circle:{circle:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-6,e=t.radius<n.radius?t.radius:n.radius,i=t.radius<n.radius?n.radius:t.radius,o=t.radius<n.radius?t.origin:n.origin,u=t.radius<n.radius?n.origin:t.origin,c=[o[0]-u[0],o[1]-u[1]],a=Math.sqrt(Math.pow(c[0],2)+Math.pow(c[1],2));if(!(a<r&&Math.abs(i-e)<r||a<r)){var f=c.map((function(t,n){return t/a*i+u[n]}));if(Math.abs(i+e-a)<r||Math.abs(i-(e+a))<r)return[f];if(!(a+e<i||i+e<a)){var s=X((e*e-a*a-i*i)/(-2*a*i)),p=Y(u,f,+s),h=Y(u,f,-s);return[p,h]}}},line:tt,ray:nt,segment:rt},line:{poly:function(t,n){return it(n,t)},circle:function(t,n){return tt(n,t)},line:function(t,n){return T(t,n,x)},ray:function(t,n,r){return T(t,n,!1===r?k:q)},segment:function(t,n,r){return T(t,n,!1===r?z:_)}},ray:{poly:function(t,n){return ot(n,t)},circle:function(t,n){return nt(n,t)},line:function(t,n,r){return T(n,t,!1===r?k:q)},ray:function(t,n,r){return T(t,n,!1===r?L:N)},segment:function(t,n,r){return T(t,n,!1===r?C:G)}},segment:{poly:function(t,n){return ut(n,t)},circle:function(t,n){return rt(n,t)},line:function(t,n,r){return T(n,t,!1===r?z:_)},ray:function(t,n,r){return T(n,t,!1===r?C:G)},segment:function(t,n,r){return T(t,n,!1===r?R:I)}}},at=function(t,n){var r=h(t),e=h(n);return(0,ct[r][e])(t,n)},ft={circle:{A:function(){var t=Array.from(arguments),n=t.filter((function(t){return!isNaN(t)})),r=M(t);3===n.length?(this.origin=a.vector(n[0],n[1]),this.radius=n[2]):2===r.length&&(this.radius=o.apply(void 0,s(r)),this.origin=a.vector.apply(a,s(r[0])))},G:{x:function(){return this.origin[0]},y:function(){return this.origin[1]}},M:{intersect:function(t){return at(this,t)}},S:{fromPoints:function(){var t=M(innerArgs);return a.circle(t,o(t[0],t[1]))}}}},st=function(){};st.prototype.area=function(){return D(this.points)},st.prototype.midpoint=function(){return e(this.points)},st.prototype.centroid=function(){return U(this.points)},st.prototype.enclosingRectangle=function(){return V(this.points)},st.prototype.contains=function(){return S(d(arguments),this.points)},st.prototype.scale=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U(this.points),r=this.points.map((function(t){return[0,1].map((function(r,e){return t[e]-n[e]}))})).map((function(r){return r.map((function(e,i){return n[i]+r[i]*t}))}));return a.polygon(r)},st.prototype.rotate=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U(this.points),r=this.points.map((function(r){var e=[r[0]-n[0],r[1]-n[1]],i=Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)),o=Math.atan2(e[1],e[0]);return[n[0]+Math.cos(o+t)*i,n[1]+Math.sin(o+t)*i]}));return a.polygon(r)},st.prototype.translate=function(){var t=d(arguments),n=this.points.map((function(n){return n.map((function(n,r){return n+t[r]}))}));return a.polygon(n)},st.prototype.transform=function(){var t=w(arguments),n=this.points.map((function(n){return F(t,n)}));return a.polygon(n)},st.prototype.sectors=function(){return this.points.map((function(t,n,r){var e=(n+r.length-1)%r.length,i=(n+1)%r.length,o=t,u=r[e].map((function(t,n){return t-o[n]})),c=r[i].map((function(t,n){return t-o[n]}));return a.sector(c,u,o)}))},st.prototype.enclosingRectangle=function(){return a.rect(V(this.points))},st.prototype.clipSegment=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var e=A(n),i=ut(this.points,e[0],e[1]);return void 0===i?void 0:a.segment(i)},st.prototype.clipLine=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var e=j(n),i=it(this.points,e.origin,e.vector);return void 0===i?void 0:a.segment(i)},st.prototype.clipRay=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var e=j(n),i=ot(this.points,e.origin,e.vector);return void 0===i?void 0:a.segment(i)},st.prototype.split=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var e=j(n);return $(this.points,e.origin,e.vector).map((function(t){return a.polygon(t)}))};var pt=function(t,n,r,e){return[[t,n],[t+r,n],[t+r,n+e],[t,n+e]]},ht=function(t,n){return Array(t).fill(0).map((function(t,r){return n[r]?n[r]:t}))},lt={rect:{P:st.prototype,A:function(){var t=ht(4,y(arguments));this.origin=[t[0],t[1]],this.width=t[2],this.height=t[3],this.points=pt.apply(void 0,s(t))},G:{x:function(){return this.origin[0]},y:function(){return this.origin[1]}},M:{area:function(){return this.width*this.height},scale:function(t,n){var r=null!=n?n:[this.origin[0]+this.width,this.origin[1]+this.height],e=this.origin[0]+(r[0]-this.origin[0])*(1-t),i=this.origin[1]+(r[1]-this.origin[1])*(1-t);return a.rect(e,i,this.width*t,this.height*t)}},S:{fromPoints:function(){return a.rect(V(M(arguments)))}}}},vt={polygon:{P:st.prototype,A:function(){this.points=m(arguments)},G:{},M:{},S:{}}},gt=function(){};gt.prototype.isParallel=function(){var t=v(this.vector,j.apply(void 0,arguments).vector);return console.log(arguments,this.vector,j.apply(void 0,arguments).vector,t),O.apply(void 0,s(t))},gt.prototype.isDegenerate=function(){return t=this.vector,Math.abs(t.reduce((function(t,n){return t+n}),0))<1e-6;var t},gt.prototype.reflection=function(){return Matrix2.makeReflection(this.vector,this.origin)},gt.prototype.nearestPoint=function(){var t=d(arguments);return Vector(c(this.origin,this.vector,t,this.clip_function))},gt.prototype.intersect=function(t){return at(this,t)};var mt={line:{P:gt.prototype,A:function(){var t=j.apply(void 0,arguments);this.origin=a.vector(t.origin),this.vector=a.vector(t.vector)},G:{length:function(){return 1/0}},M:{transform:function(){var t=w(arguments),n=H(t,this.origin,this.vector);return a.line(n[0],n[1])},clip_function:function(t){return t}},S:{fromPoints:function(){var t=M(arguments);return a.line({origin:t[0],vector:[t[1][0]-t[0][0],t[1][1]-t[0][1]]})},perpendicularBisector:function(){var t=M(arguments),n=[t[1][0]-t[0][0],t[1][1]-t[0][1]];return a.line({origin:e(t[0],t[1]),vector:[n[1],-n[0]]})}}}},yt={ray:{P:gt.prototype,A:function(){var t=j.apply(void 0,arguments);this.origin=a.vector(t.origin),this.vector=a.vector(t.vector)},G:{length:function(){return 1/0}},M:{transform:function(){for(var t=this,n=arguments.length,r=new Array(n),e=0;e<n;e++)r[e]=arguments[e];var i=w(r),o=this.vector.map((function(n,r){return n+t.origin[r]})),u=multiply_matrix2_vector2(i,this.origin),c=multiply_matrix2_vector2(i,o).map((function(t,n){return t-u[n]}));return a.ray(u,c)},rotate180:function(){return a.ray(this.origin[0],this.origin[1],-this.vector[0],-this.vector[1])},clip_function:function(t){return t<-EPSILON?0:t}},S:{fromPoints:function(){var t=M(arguments);return a.ray({origin:t[0],vector:[t[1][0]-t[0][0],t[1][1]-t[0][1]]})}}}},dt={segment:{P:gt.prototype,A:function(){this.points=A.apply(void 0,arguments).map((function(t){return a.vector(t)})),this.origin=this.points[0],this.vector=this.points[1].subtract(this.points[0])},G:{0:function(){return this.points[0]},1:function(){return this.points[1]},length:function(){return this.vector.magnitude()}},M:{clip_function:function(t){return t<-EPSILON?0:t>1+EPSILON?1:t},transform:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var e=w(n),i=this.points.map((function(t){return F(e,t)}));return Constructor.segment(i)},scale:function(t){var n=e(this.points[0],this.points[1]),r=this.points.map((function(r){return r.lerp(n,t)}));return Constructor.segment(r)},midpoint:function(){return Constructor.vector(e(this.points[0],this.points[1]))}},S:{fromPoints:a.segment}}},Mt=function(t,n){var r=Object.create(bt[t].proto);return bt[t].A.apply(r,n),Object.freeze(r)},bt=Object.assign({},W,ft,lt,vt,mt,yt,dt);Object.assign(a,{vector:function(){return Mt("vector",arguments)},circle:function(){return Mt("circle",arguments)},rect:function(){return Mt("rect",arguments)},polygon:function(){return Mt("polygon",arguments)},line:function(){return Mt("line",arguments)},ray:function(){return Mt("ray",arguments)},segment:function(){return Mt("segment",arguments)}}),Object.keys(bt).forEach((function(t){var n={};n.prototype=null!=bt[t].P?Object.create(bt[t].P):Object.create(Object.prototype),n.prototype.constructor=n,Object.keys(bt[t].G).forEach((function(r){return Object.defineProperty(n.prototype,r,{get:bt[t].G[r],enumerable:!0})})),Object.keys(bt[t].M).forEach((function(r){return Object.defineProperty(n.prototype,r,{value:bt[t].M[r]})})),Object.keys(bt[t].S).forEach((function(n){return Object.defineProperty(a[t],n,{value:bt[t].S[n]})})),a[t].prototype=n.prototype,a[t].prototype.constructor=a[t],Object.freeze(n.prototype),bt[t].proto=n.prototype}));var wt=a;return wt.core={nearest_point:function(t,n){var r=function(t,n,r){for(var e,i=n.map((function(n,e){return{o:n,i:e,d:r(t,n)}})),o=1/0,u=0;u<i.length;u+=1)i[u].d<o&&(e=u,o=i[u].d);return e}(t,n,u);return void 0===r?void 0:n[r]},magnitude:t,normalize:n,dot:r,average:e,midpoint2:function(t,n){return t.map((function(r,e){return(t[e]+n[e])/2}))},cross2:function(t,n){return[t[0]*n[1],t[1]*n[0]]},cross3:i,distance2:o,distance3:function(t,n){var r=t[0]-n[0],e=t[1]-n[1],i=t[2]-n[2];return Math.sqrt(r*r+e*e+i*i)},distance:u},wt}));
