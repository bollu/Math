/* Geometry (c) Robby Kraft, MIT License */
(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.Geometry={})})(this,function(a){"use strict";var i=Math.sin,j=Math.cos,k=Math.sqrt,l=Math.pow,m=Math.abs;function c(){let a=Array.from(arguments);if(0==a.length)return[];if(null!=a[0].vector&&a[0].vector.constructor==Array)return a[0].vector;let b=a.filter(a=>a.constructor===Array);if(1<=b.length)return b[0];let c=a.filter(a=>!isNaN(a));return 1<=c.length?c:isNaN(a[0].x)?[]:["x","y","z"].map(b=>a[0][b]).filter(b=>null!=b)}function e(){let a=Array.from(arguments),b=a.filter(a=>!isNaN(a)),c=a.filter(a=>a.constructor===Array);if(0==a.length)return[];if(null!=a[0].m&&a[0].m.constructor==Array&&(b=a[0].m.slice()),0==b.length&&1<=c.length&&(b=c[0]),6<=b.length)return b.slice(0,6);if(4<=b.length){let a=b.slice(0,4);return a[4]=0,a[5]=0,a}return[1,0,0,1,0,0]}function f(a,c,d=n){return!!(null!=a&&0<a.length)&&a.map((e,f,g)=>{let h=g[(f+1)%g.length],i=[h[0]-e[0],h[1]-e[1]],a=[c[0]-e[0],c[1]-e[1]];return i[0]*a[1]-i[1]*a[0]>-d}).map((a,b,c)=>a==c[0]).reduce((a,b)=>a&&b,!0)}function g(){let d=c(...arguments);const a=function(){let a=d.map(a=>a*a).reduce((a,b)=>a+b);return k(a)},b=function(){let e=c(...arguments),b=d.slice();return null==b[2]&&(b[2]=0),null==e[2]&&(e[2]=0),b[1]*e[2]-b[2]*e[1]-(b[0]*e[2]-b[2]*e[0])+(b[0]*e[1]-b[1]*e[0])},f=function(){let a=e(...arguments);return g(d[0]*a[0]+d[1]*a[2]+a[4],d[0]*a[1]+d[1]*a[3]+a[5])};return Object.freeze({normalize:function(){let b=a(),c=d.map(a=>a/b);return g(c)},magnitude:a,dot:function(){let a=c(...arguments),b=d.length<a.length?d.length:a.length;return Array.from(Array(b)).map((b,c)=>d[c]*a[c]).reduce((a,b)=>a+b,0)},cross:function(){return b(...arguments)},distanceTo:function(){let a=c(...arguments),b=d.length<a.length?d.length:a.length,e=Array.from(Array(b)).map((b,c)=>l(d[c]-a[c],2)).reduce((a,b)=>a+b,0);return k(e)},transform:f,rotateZ:function(a,b){return f(h().rotation(a,b))},rotateZ90:function(){return g(-d[1],d[0])},rotateZ180:function(){return g(-d[0],-d[1])},rotateZ270:function(){return g(d[1],-d[0])},reflect:function(){let a=get_line(...arguments);return f(h().reflection(a.vector,a.point))},lerp:function(a,b){let e=c(a),f=d.length<e.length?d.length:e.length,h=Array.from(Array(f)).map((a,c)=>d[c]*b+e[c]*(1-b));return g(h)},equivalent:function(a,b=EPSILON_HIGH){let e=c(a),f=d.length<e.length?d.slice():e,g=d.length<e.length?e:d.slice();for(var h=f.length;h<g.length;h++)f[h]=0;return g.map((a,c)=>m(f[c]-g[c])<b).reduce((a,b)=>a&&b,!0)},scale:function(a){return g(d.map(b=>b*a))},midpoint:function(){let a=c(...arguments),b=d.length<a.length?d.slice():a,e=d.length<a.length?a:d.slice();for(var f=b.length;f<e.length;f++)b[f]=0;return g(e.map((a,c)=>.5*(b[c]+e[c])))},get vector(){return d},get x(){return d[0]},get y(){return d[1]},get z(){return d[2]}})}function h(){let f=e(...arguments);return Object.freeze({inverse:function(){var e=f[0]*f[3]-f[1]*f[2];if(!e||isNaN(e)||!isFinite(f[4])||!isFinite(f[5]))return;let g=f[3]/e,a=-f[1]/e,b=-f[2]/e,c=f[0]/e,d=(f[2]*f[5]-f[3]*f[4])/e,i=(f[1]*f[4]-f[0]*f[5])/e;return h(g,a,b,c,d,i)},multiply:function(){let g=e(...arguments),i=f[0]*g[0]+f[2]*g[1],a=f[0]*g[2]+f[2]*g[3],c=f[0]*g[4]+f[2]*g[5]+f[4],j=f[1]*g[0]+f[3]*g[1],b=f[1]*g[2]+f[3]*g[3],d=f[1]*g[4]+f[3]*g[5]+f[5];return h(i,j,a,b,c,d)},transform:function(){let a=c(...arguments);return g(a[0]*f[0]+a[1]*f[2]+f[4],a[0]*f[1]+a[1]*f[3]+f[5])},get m(){return f}})}const n=1e-10,o=function(){return!0},p=function(a,b,c=n){return b>=-c},q=function(a,b,c=n){return b>=-c&&b<=1+c},r=function(a,b,c=n){return a>=-c&&b>=-c},s=function(a,b,c=n){return a>=-c&&b>=-c&&b<=1+c},t=function(a,b,c=n){return a>=-c&&a<=1+c&&b>=-c&&b<=1+c};var u=function(a,b,c,d,e,f=n){function g(c,a){return c[0]*a[1]-a[0]*c[1]}var h=g(b,d);if(!(m(h)<f)){var i=g([c[0]-a[0],c[1]-a[1]],d),j=g([a[0]-c[0],a[1]-c[1]],b),k=i/h;if(e(k,j/-h,f))return[a[0]+b[0]*k,a[1]+b[1]*k]}},v=Object.freeze({line_line:function(a,b,c,d,e){return u(a,b,c,d,o,e)},line_ray:function(a,b,c,d,e){return u(a,b,c,d,p,e)},line_edge:function(a,b,c,d,e){let f=[d[0]-c[0],d[1]-c[1]];return u(a,b,c,f,q,e)},ray_ray:function(a,b,c,d,e){return u(a,b,c,d,r,e)},ray_edge:function(a,b,c,d,e){let f=[d[0]-c[0],d[1]-c[1]];return u(a,b,c,f,s,e)},edge_edge:function(a,b,c,d,e){let f=[b[0]-a[0],b[1]-a[1]],g=[d[0]-c[0],d[1]-c[1]];return u(a,f,c,g,t,e)},line_edge_exclusive:function(a,b,c,d){let e=[d[0]-c[0],d[1]-c[1]],f=u(a,b,c,e,q);return null==f||points_equivalent(f,c)||points_equivalent(f,d)?void 0:f},point_on_line:function(a,b,c,d=n){let e=[c[0]-a[0],c[1]-a[1]],f=e[0]*b[1]-e[1]*b[0];return m(f)<d},point_on_edge:function(a,b,c,d=n){let e=k(l(a[0]-b[0],2)+l(a[1]-b[1],2)),f=k(l(c[0]-a[0],2)+l(c[1]-a[1],2)),g=k(l(c[0]-b[0],2)+l(c[1]-b[1],2));return m(e-f-g)<d},point_in_polygon:f,polygons_overlap:function(a,b){let c=a.map((a,b,c)=>[a,c[(b+1)%c.length]]),d=b.map((a,b,c)=>[a,c[(b+1)%c.length]]);for(let e=0;e<c.length;e++)for(let a=0;a<d.length;a++)if(edge_edge_intersection(c[e][0],c[e][1],d[a][0],d[a][1])!=null)return!0;return!!f(a,b[0])||!!f(b,a[0])}});h.identity=function(){return h(1,0,0,1,0,0)},h.rotation=function(e,f){var g=j(e),a=i(e),b=-i(e),c=j(e),d=null==f?0:f[0],k=null==f?0:f[1];return h(g,a,b,c,d,k)},h.reflection=function(e,f){let g=Math.atan2(e[1],e[0]),k=j(g),l=i(g),m=j(-g),n=i(-g),o=k*m+l*n,a=k*-n+l*m,b=l*m+-k*n,c=l*-n+-k*m,d=f[0]+o*-f[0]+-f[1]*b,p=f[1]+a*-f[0]+-f[1]*c;return h(o,a,b,c,d,p)},a.Intersection=v,a.Vector=g,a.Matrix=h,Object.defineProperty(a,"__esModule",{value:!0})});
